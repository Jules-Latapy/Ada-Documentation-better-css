<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<HTML>
<HEAD>
    <TITLE>Round Robin Dispatching</TITLE>
    <META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
    <META NAME="Author" CONTENT="JTC1/SC22/WG9/ARG, by Randall Brukardt, ARG Editor">
    <META NAME="GENERATOR" CONTENT="Arm_Form.Exe, Ada Reference Manual generator">
    <link rel="stylesheet" href="../styles.css">
	<link rel="icon" href="../logo.svg">
</HEAD>
<BODY TEXT="#000000" BGCOLOR="#FFFFF0" LINK="#000080" VLINK="#330033" ALINK="#0000FF">
<DIV><B><SPAN Style="font-size:200%; color: rgb(0,51,153)">Annotated</SPAN><SPAN Style="font-size:200%; color: rgb(0,0,102)">&nbsp;Ada Reference Manual</SPAN></B> &mdash; <A HREF="AA-TTL.html"><B>Legal Information</B></A></DIV>
<div style="margin-top: 0.6em; margin-bottom: 0.0em"><A HREF="AA-TOC.html"><IMG SRC="cont.gif" ALT="Contents" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-0-4.html"><IMG SRC="index.gif" ALT="Index" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-STDS.html"><IMG SRC="lib.gif" ALT="References" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-SRCH.html"><IMG SRC="find.gif" ALT="Search" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-D-2-4.html"><IMG SRC="prev.gif" ALT="Previous" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-D-2-6.html"><IMG SRC="next.gif" ALT="Next" BORDER=0></A>&nbsp;
</div>
<div class="main">
<H1>D.2.5 <span class="insert2">Round Robin Dispatching</span><span class="delete2"></span></H1>
<div class="paranum"><a name="p1">1/3</a></div>
<div class="Normal">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00355.TXT">AI95-00355-01</A></I>} 
<span class="insert2"></span>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0299-1.TXT">AI05-0299-1</A></I>} 
<span class="insert2">[This&nbsp;</span><span class="insert3">subclause</span><span class="insert2"></span><span class="insert2"><span class="delete3">&nbsp;clause</span></span><span class="insert2">&nbsp;defines the task dispatching policy Round_Robin_Within_Priorities and 
the package Round_Robin.]</span>&nbsp;</div>

<H4 Class="centered">Static Semantics</H4>
<div class="paranum"><a name="p2">2/2</a></div>
<div class="Normal">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00355.TXT">AI95-00355-01</A></I>} 
<span class="insert2">The <I>policy</I>_<SPAN Class="swiss"><A HREF="AA-2-3.html#S0002">identifier</A></SPAN> 
Round_Robin_Within_Priorities is a task dispatching policy.</span><span class="insert3"><A NAME="I8750"></A><A NAME="I8751"></A></span><span class="insert2"></span></div>
<div class="paranum"><a name="p3">3/2</a></div>
<div class="Normal" style="margin-bottom: 0.4em">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00355.TXT">AI95-00355-01</A></I>} 
<span class="insert2">The following language-defined library package 
exists:</span>&nbsp;</div>
<div class="paranum"><a name="p4">4/2</a></div>
<div class="Examples"><span class="insert2"><B>with</B>&nbsp;System;<BR>
<B>with</B>&nbsp;Ada.Real_Time;<BR>
<B>package</B>&nbsp;Ada.Dispatching.Round_Robin&nbsp;<B>is</B><A NAME="I8752"></A><BR>
&nbsp;&nbsp;<A NAME="I8753"></A>Default_Quantum&nbsp;:&nbsp;<B>constant</B>&nbsp;Ada.Real_Time.Time_Span&nbsp;:=<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<SPAN Class="roman"><I>implementation-defined</I></SPAN>;<BR>
&nbsp;&nbsp;<B>procedure</B>&nbsp;<A NAME="I8754"></A>Set_Quantum&nbsp;(Pri&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;<B>in</B>&nbsp;System.Priority;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Quantum&nbsp;:&nbsp;<B>in</B>&nbsp;Ada.Real_Time.Time_Span);<BR>
&nbsp;&nbsp;<B>procedure</B>&nbsp;<A NAME="I8755"></A>Set_Quantum&nbsp;(Low,&nbsp;High&nbsp;:&nbsp;<B>in</B>&nbsp;System.Priority;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Quantum&nbsp;&nbsp;&nbsp;:&nbsp;<B>in</B>&nbsp;Ada.Real_Time.Time_Span);<BR>
&nbsp;&nbsp;<B>function</B>&nbsp;<A NAME="I8756"></A>Actual_Quantum&nbsp;(Pri&nbsp;:&nbsp;System.Priority)<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<B>return</B>&nbsp;Ada.Real_Time.Time_Span;<BR>
&nbsp;&nbsp;<B>function</B>&nbsp;<A NAME="I8757"></A>Is_Round_Robin&nbsp;(Pri&nbsp;:&nbsp;System.Priority)&nbsp;<B>return</B>&nbsp;Boolean;<BR>
<B>end</B>&nbsp;Ada.Dispatching.Round_Robin;</span></div>
<div class="paranum"><a name="p4.a.1">4.a.1/2</a></div>
<div class="Annotations"><span class="insert2"><B>Implementation defined: 
</B></span><span class="insert2">The value of Default_Quantum in Dispatching.Round_Robin.</span></div>
<div class="paranum"><a name="p5">5/2</a></div>
<div class="Normal">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00355.TXT">AI95-00355-01</A></I>} 
<span class="insert2">When task dispatching policy Round_Robin_Within_Priorities 
is the single policy in effect for a partition, each task with priority 
in the range of System.Interrupt_Priority is dispatched according to 
policy FIFO_Within_Priorities.</span></div>

<H4 Class="centered">Dynamic Semantics</H4>
<div class="paranum"><a name="p6">6/2</a></div>
<div class="Normal">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00355.TXT">AI95-00355-01</A></I>} 
<span class="insert2">The procedures Set_Quantum set the required Quantum 
value for a single priority level Pri or a range of priority levels Low 
.. High. If no quantum is set for a Round Robin priority level, Default_Quantum 
is used.</span></div>
<div class="paranum"><a name="p7">7/2</a></div>
<div class="Normal">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00355.TXT">AI95-00355-01</A></I>} 
<span class="insert2">The function Actual_Quantum returns the actual 
quantum used by the implementation for the priority level Pri.</span></div>
<div class="paranum"><a name="p8">8/3</a></div>
<div class="Normal">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00355.TXT">AI95-00355-01</A></I>} 
<span class="insert2"></span>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0264-1.TXT">AI05-0264-1</A></I>} 
<span class="insert2">The function Is_Round_Robin returns True if priority 
Pri is covered by task dispatching policy Round_Robin_Within_Priorities; 
otherwise</span><span class="insert3">,</span><span class="insert2">&nbsp;it returns False.</span></div>
<div class="paranum"><a name="p9">9/2</a></div>
<div class="Normal">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00355.TXT">AI95-00355-01</A></I>} 
<span class="insert2">A call of Actual_Quantum or Set_Quantum raises 
exception Dispatching.Dispatching_Policy_Error if a predefined policy 
other than Round_Robin_Within_Priorities applies to the specified priority 
or any of the priorities in the specified range.</span></div>
<div class="paranum"><a name="p10">10/2</a></div>
<div class="Normal" style="margin-bottom: 0.4em">&nbsp;{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00355.TXT">AI95-00355-01</A></I>} 
<span class="insert2">For Round_Robin_Within_Priorities, the dispatching 
rules for FIFO_Within_Priorities apply with the following additional 
rules:</span></div>
<div class="paranum"><a name="p11">11/2</a></div>
<div class="Bulleted"><span class="insert2">When a task is added or moved 
to the tail of the ready queue for its base priority, it has an execution 
time budget equal to the quantum for that priority level. This will also 
occur when a blocked task becomes executable again.</span></div>
<div class="paranum"><a name="p12">12/2</a></div>
<div class="Bulleted"><span class="insert2">When a task is preempted 
(by a higher priority task) and is added to the head of the ready queue 
for its priority level, it retains its remaining budget.</span></div>
<div class="paranum"><a name="p13">13/2</a></div>
<div class="Bulleted"><span class="insert2">While a task is executing, 
its budget is decreased by the amount of execution time it uses. The 
accuracy of this accounting is the same as that for execution time clocks 
(see <A HREF="AA-D-14.html">D.14</A>).</span>&nbsp;</div>
<div class="paranum"><a name="p13.a">13.a/2</a></div>
<div class="Annotations"><span class="insert2"><B>Ramification:&nbsp;</B>Note 
that this happens even when the task is executing at a higher, inherited 
priority, and even if that higher priority is dispatched by a different 
policy than round robin.</span>&nbsp;</div>
<div class="paranum"><a name="p14">14/2</a></div>
<div class="Bulleted"><span class="insert2">When a task has exhausted 
its budget and is without an inherited priority (and is not executing 
within a protected operation), it is moved to the tail of the ready queue 
for its priority level. This is a task dispatching point.</span></div>
<div class="paranum"><a name="p14.a">14.a/2</a></div>
<div class="Annotations"><span class="insert2"><B>Ramification:&nbsp;</B>In 
this case, it will be given a budget as described in the first bullet.</span></div>
<div class="paranum"><a name="p14.b">14.b/2</a></div>
<div class="Annotations"><span class="insert2">The rules for FIFO_Within_Priority 
(to which these bullets are added) say that a task that has its base 
priority set to a Round Robin priority is moved to the tail of the ready 
queue for its new priority level, and then will be given a budget as 
described in the first bullet. That happens whether or not the task's 
original base priority was a Round Robin priority.</span>&nbsp;</div>

<H4 Class="centered">Implementation Requirements</H4>
<div class="paranum"><a name="p15">15/2</a></div>
<div class="Normal">&nbsp;{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00333.TXT">AI95-00333-01</A></I>} 
<span class="insert2"></span>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00355.TXT">AI95-00355-01</A></I>} 
<span class="insert2">An implementation shall allow, for a single partition, 
both the task dispatching policy to be specified as Round_Robin_Within_Priorities 
and also the locking policy (see <A HREF="AA-D-3.html">D.3</A>) to be 
specified as Ceiling_Locking.</span>&nbsp;</div>
<div class="paranum"><a name="p15.a">15.a/2</a></div>
<div class="Annotations"><span class="insert2"><B>Reason:&nbsp;</B>This is 
the preferred combination of the Round_Robin_Within_Priorities policy 
with a locking policy, and we want that combination to be portable.</span> 
</div>

<H4 Class="centered">Documentation Requirements</H4>
<div class="paranum"><a name="p16">16/2</a></div>
<div class="Normal">&nbsp;{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00355.TXT">AI95-00355-01</A></I>} 
<span class="insert2">An implementation shall document the quantum values 
supported.</span>&nbsp;</div>
<div class="paranum"><a name="p16.a.1">16.a.1/2</a></div>
<div class="Annotations"><span class="insert2"><B>Documentation Requirement: 
</B></span><span class="insert2">The quantum values supported for round 
robin dispatching.</span></div>
<div class="paranum"><a name="p17">17/2</a></div>
<div class="Normal">&nbsp;{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00355.TXT">AI95-00355-01</A></I>} 
<span class="insert2">An implementation shall document the accuracy with 
which it detects the exhaustion of the budget of a task.</span>&nbsp;</div>
<div class="paranum"><a name="p17.a.1">17.a.1/2</a></div>
<div class="Annotations"><span class="insert2"><B>Documentation Requirement: 
</B></span><span class="insert2">The accuracy of the detection of the 
exhaustion of the budget of a task for round robin dispatching.</span></div>
<div class="NotesHeader">NOTES</div>
<div class="paranum"><a name="p18">18/2</a></div>
<div class="Notes">19&nbsp;&nbsp;{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00355.TXT">AI95-00355-01</A></I>} 
<span class="insert2">Due to implementation constraints, the quantum 
value returned by Actual_Quantum might not be identical to that set with 
Set_Quantum.</span></div>
<div class="paranum"><a name="p19">19/2</a></div>
<div class="Notes">20&nbsp;&nbsp;{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00355.TXT">AI95-00355-01</A></I>} 
<span class="insert2">A task that executes continuously with an inherited 
priority will not be subject to round robin dispatching.</span></div>

<H4 Class="centered">Extensions to Ada 95</H4>
<div class="paranum"><a name="p19.a">19.a/2</a></div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00355.TXT">AI95-00355-01</A></I>} 
<span class="insert2"><A NAME="I8758"></A>Policy Round_Robin_Within_Priorities 
and package Dispatching.Round_Robin are new.</span>&nbsp;</div>

</div>
<div style="margin-top: 0.0em; margin-bottom: 0.6em"><A HREF="AA-TOC.html"><IMG SRC="cont.gif" ALT="Contents" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-0-4.html"><IMG SRC="index.gif" ALT="Index" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-STDS.html"><IMG SRC="lib.gif" ALT="References" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-SRCH.html"><IMG SRC="find.gif" ALT="Search" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-D-2-4.html"><IMG SRC="prev.gif" ALT="Previous" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-D-2-6.html"><IMG SRC="next.gif" ALT="Next" BORDER=0></A>&nbsp;
</div>
<DIV Style="margin-top:0.0em"><IMG SRC="AE_logo.gif" height=100 width=113 align=right ALT="Ada-Europe">
<SPAN Style="vertical-align: middle; font-size:120%">Ada 2005 and 2012 Editions sponsored in part by <SPAN Style="font-size: 125%"><A HREF="http://www.ada-europe.org/"><B>Ada-Europe</B></A></SPAN></SPAN></DIV>
</BODY>
</HTML>
