<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<HTML>
<HEAD>
    <TITLE>Requeue Statements</TITLE>
    <META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
    <META NAME="Author" CONTENT="JTC1/SC22/WG9/ARG, by Randall Brukardt, ARG Editor">
    <META NAME="GENERATOR" CONTENT="Arm_Form.Exe, Ada Reference Manual generator">
    <link rel="stylesheet" href="../styles.css">
	<link rel="icon" href="../logo.svg">
</HEAD>
<BODY TEXT="#000000" BGCOLOR="#FFFFF0" LINK="#000080" VLINK="#330033" ALINK="#0000FF">
<DIV><B><SPAN Style="font-size:200%; color: rgb(0,51,153)">Annotated</SPAN><SPAN Style="font-size:200%; color: rgb(0,0,102)">&nbsp;Ada Reference Manual</SPAN></B> &mdash; <A HREF="AA-TTL.html"><B>Legal Information</B></A></DIV>
<div class="navig"><A HREF="AA-TOC.html">Contents</A>&nbsp;
&nbsp;<A HREF="AA-0-4.html">Index</A>&nbsp;
&nbsp;<A HREF="AA-STDS.html">References</A>&nbsp;
&nbsp;<A HREF="../RM-SRCH.html">Search</A>&nbsp;
&nbsp;<A HREF="AA-9-5-3.html">Previous</A>&nbsp;
&nbsp;<A HREF="AA-9-6.html">Next</A>&nbsp;
<img SRC="../logo.svg" class="adaLogo">
</div>
<div class="main">
<H1>9.5.4 Requeue Statements</H1>
<div class="paranum"><a name="p1">1</a></div>
<div class="Normal">[A <SPAN Class="swiss"><A HREF="AA-9-5-4.html#S0226">requeue_statement</A></SPAN> 
can be used to complete an <SPAN Class="swiss"><A HREF="AA-9-5-2.html#S0219">accept_statement</A></SPAN> 
or <SPAN Class="swiss"><A HREF="AA-9-5-2.html#S0221">entry_body</A></SPAN>, 
while redirecting the corresponding entry call to a new (or the same) 
entry queue. <A NAME="I4612"></A>Such a <I>requeue</I> can be performed 
with or without allowing an intermediate cancellation of the call, due 
to an abort or the expiration of a delay. <A NAME="I4613"></A><A NAME="I4614"></A>]</div>

<H4 Class="centered">Syntax</H4>
<div class="paranum"><a name="p2">2/3</a></div>
<div class="Indented1">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0030-2.TXT">AI05-0030-2</A></I>} 
<SPAN Class="swiss">requeue_statement</SPAN><A NAME="I4615"></A><A NAME="S0226"></A><SPAN Class="swiss">&nbsp;::=&nbsp;</SPAN><B>requeue</B>&nbsp;<I></I><span class="insert3"><I>procedure_or_entry_</I></span><I></I><span class="delete3"><I>&nbsp;entry_</I></span><I></I><A NAME="I4616"></A><SPAN Class="swiss"><A HREF="AA-4-1.html#S0091">name</A></SPAN>&nbsp;[<B>with</B>&nbsp;<B>abort</B>];</div>

<H4 Class="centered">Name Resolution Rules</H4>
<div class="paranum"><a name="p3">3/3</a></div>
<div class="Normal">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0030-2.TXT">AI05-0030-2</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0215-1.TXT">AI05-0215-1</A></I>} 
<span class="insert3"><A NAME="I4617"></A></span><span class="delete3"><A NAME="I4618"></A></span>The 
<span class="insert3"><I>procedure_or_entry_</I></span><span class="delete3"><I>&nbsp;entry_</I></span><SPAN Class="swiss"><A HREF="AA-4-1.html#S0091">name</A></SPAN> 
of a <SPAN Class="swiss"><A HREF="AA-9-5-4.html#S0226">requeue_statement</A></SPAN> 
shall resolve to denote <span class="insert3">a procedure or&nbsp;</span>an 
entry (the <span class="insert3"><I>requeue&nbsp;</I></span><I>target</I><span class="delete3"><I>&nbsp;entry</I></span>)<span class="insert3">. The profile of the entry, or 
the profile or prefixed profile of the procedure, shall</span><span class="delete3">&nbsp;that</span> 
either <span class="insert3">have</span><span class="delete3">&nbsp;has</span> 
no parameters, or <span class="insert3">be</span><span class="delete3">&nbsp;that 
has a profile that is</span> type conformant (see <A HREF="AA-6-3-1.html">6.3.1</A>) 
with the profile of the innermost enclosing <SPAN Class="swiss"><A HREF="AA-9-5-2.html#S0221">entry_body</A></SPAN> 
or <SPAN Class="swiss"><A HREF="AA-9-5-2.html#S0219">accept_statement</A></SPAN>. 
<A NAME="I4619"></A></div>

<H4 Class="centered">Legality Rules</H4>
<div class="paranum"><a name="p4">4</a></div>
<div class="Normal">A <SPAN Class="swiss"><A HREF="AA-9-5-4.html#S0226">requeue_statement</A></SPAN> 
shall be within a callable construct that is either an <SPAN Class="swiss"><A HREF="AA-9-5-2.html#S0221">entry_body</A></SPAN> 
or an <SPAN Class="swiss"><A HREF="AA-9-5-2.html#S0219">accept_statement</A></SPAN>, 
and this construct shall be the innermost enclosing body or callable 
construct.</div>
<div class="paranum"><a name="p5">5/3</a></div>
<div class="Normal">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0030-2.TXT">AI05-0030-2</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0215-1.TXT">AI05-0215-1</A></I>} 
If the <span class="insert3">requeue&nbsp;</span>target<span class="delete3">&nbsp;entry</span> has parameters, then its <span class="insert3">(prefixed) 
</span>profile shall be subtype conformant with the profile of the innermost 
enclosing callable construct. <A NAME="I4620"></A></div>
<div class="paranum"><a name="p5.1">5.1/3</a></div>
<div class="Normal">&nbsp;&nbsp;{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0030-2.TXT">AI05-0030-2</A></I>} 
<span class="insert3"></span>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0215-1.TXT">AI05-0215-1</A></I>} 
<span class="insert3">If the target is a procedure, the name shall denote 
a renaming of an entry, or shall denote a view or a prefixed view of 
a primitive subprogram of a synchronized interface, where the first parameter 
of the unprefixed view of the primitive subprogram shall be a controlling 
parameter, and the Synchronization aspect shall be specified with <SPAN Class="swiss"><A HREF="AA-9-5.html#S0217">synchronization_kind</A></SPAN> 
By_Entry for the primitive subprogram.</span></div>
<div class="paranum"><a name="p6">6/3</a></div>
<div class="Normal">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0030-2.TXT">AI05-0030-2</A></I>} 
<A NAME="I4621"></A>In a <SPAN Class="swiss"><A HREF="AA-9-5-4.html#S0226">requeue_statement</A></SPAN> 
of an <SPAN Class="swiss"><A HREF="AA-9-5-2.html#S0219">accept_statement</A></SPAN> 
of some task unit, either the target object shall be a part of a formal 
parameter of the <SPAN Class="swiss"><A HREF="AA-9-5-2.html#S0219">accept_statement</A></SPAN>, 
or the accessibility level of the target object shall not be equal to 
or statically deeper than any enclosing <SPAN Class="swiss"><A HREF="AA-9-5-2.html#S0219">accept_statement</A></SPAN> 
of the task unit. In a <SPAN Class="swiss"><A HREF="AA-9-5-4.html#S0226">requeue_statement</A></SPAN> 
of an <SPAN Class="swiss"><A HREF="AA-9-5-2.html#S0221">entry_body</A></SPAN> 
of some protected unit, either the target object shall be a part of a 
formal parameter of the <SPAN Class="swiss"><A HREF="AA-9-5-2.html#S0221">entry_body</A></SPAN>, 
or the accessibility level of the target object shall not be statically 
deeper than that of the <SPAN Class="swiss"><A HREF="AA-9-5-2.html#S0218">entry_declaration</A></SPAN><span class="insert3">&nbsp;for the <SPAN Class="swiss"><A HREF="AA-9-5-2.html#S0221">entry_body</A></SPAN></span>.</div>
<div class="paranum"><a name="p6.a">6.a</a></div>
<div class="Annotations"><B>Ramification:&nbsp;</B>In the <SPAN Class="swiss"><A HREF="AA-9-5-2.html#S0221">entry_body</A></SPAN> 
case, the intent is that the target object can be global, or can be a 
component of the protected unit, but cannot be a local variable of the 
<SPAN Class="swiss"><A HREF="AA-9-5-2.html#S0221">entry_body</A></SPAN>. 
</div>
<div class="paranum"><a name="p6.b">6.b</a></div>
<div class="Annotations"><B>Reason:&nbsp;</B>These restrictions ensure that 
the target object of the requeue outlives the completion and finalization 
of the enclosing callable construct. They also prevent requeuing from 
a nested <SPAN Class="swiss"><A HREF="AA-9-5-2.html#S0219">accept_statement</A></SPAN> 
on a parameter of an outer <SPAN Class="swiss"><A HREF="AA-9-5-2.html#S0219">accept_statement</A></SPAN>, 
which could create some strange &quot;long-distance&quot; connections 
between an entry caller and its server.</div>
<div class="paranum"><a name="p6.c">6.c</a></div>
<div class="Annotations">Note that in the strange case where a <SPAN Class="swiss"><A HREF="AA-9-1.html#S0209">task_body</A></SPAN> 
is nested inside an <SPAN Class="swiss"><A HREF="AA-9-5-2.html#S0219">accept_statement</A></SPAN>, 
it is permissible to requeue from an <SPAN Class="swiss"><A HREF="AA-9-5-2.html#S0219">accept_statement</A></SPAN> 
of the inner <SPAN Class="swiss"><A HREF="AA-9-1.html#S0209">task_body</A></SPAN> 
on parameters of the outer <SPAN Class="swiss"><A HREF="AA-9-5-2.html#S0219">accept_statement</A></SPAN>. 
This is not a problem because all calls on the inner task have to complete 
before returning from the outer <SPAN Class="swiss"><A HREF="AA-9-5-2.html#S0219">accept_statement</A></SPAN>, 
meaning no &quot;dangling calls&quot; will be created.&nbsp;</div>
<div class="paranum"><a name="p6.d">6.d</a></div>
<div class="Annotations"><B>Implementation Note:&nbsp;</B>By disallowing certain 
requeues, we ensure that the normal <SPAN Class="swiss"><A HREF="AA-9-7-1.html#S0236">terminate_alternative</A></SPAN> 
rules remain sensible, and that explicit clearing of the entry queues 
of a protected object during finalization is rarely necessary. In particular, 
such clearing of the entry queues is necessary only (ignoring premature 
Unchecked_Deallocation) for protected objects declared in a <SPAN Class="swiss"><A HREF="AA-9-1.html#S0209">task_body</A></SPAN> 
(or created by an allocator for an access type declared in such a body) 
containing one or more <SPAN Class="swiss"><A HREF="AA-9-5-4.html#S0226">requeue_statement</A></SPAN>s. 
Protected objects declared in subprograms, or at the library level, will 
never need to have their entry queues explicitly cleared during finalization. 
</div>

<H4 Class="centered">Dynamic Semantics</H4>
<div class="paranum"><a name="p7">7/3</a></div>
<div class="Normal">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0030-2.TXT">AI05-0030-2</A></I>} 
<A NAME="I4622"></A>The execution of a <SPAN Class="swiss"><A HREF="AA-9-5-4.html#S0226">requeue_statement</A></SPAN> 
proceeds by first evaluating the <span class="insert3"><I>procedure_or_entry_</I></span><span class="delete3"><I>&nbsp;entry_</I></span><SPAN Class="swiss"><A HREF="AA-4-1.html#S0091">name</A></SPAN>[, 
including the <SPAN Class="swiss"><A HREF="AA-4-1.html#S0093">prefix</A></SPAN> 
identifying the target task or protected object and the <SPAN Class="swiss"><A HREF="AA-4-4.html#S0117">expression</A></SPAN> 
identifying the entry within an entry family, if any]. The <SPAN Class="swiss"><A HREF="AA-9-5-2.html#S0221">entry_body</A></SPAN> 
or <SPAN Class="swiss"><A HREF="AA-9-5-2.html#S0219">accept_statement</A></SPAN> 
enclosing the <SPAN Class="swiss"><A HREF="AA-9-5-4.html#S0226">requeue_statement</A></SPAN> 
is then completed[, finalized, and left (see <A HREF="AA-7-6-1.html">7.6.1</A>)].</div>
<div class="paranum"><a name="p8">8</a></div>
<div class="Normal"><A NAME="I4623"></A>For the execution of a requeue 
on an entry of a target task, after leaving the enclosing callable construct, 
the named entry is checked to see if it is open and the requeued call 
is either selected immediately or queued, as for a normal entry call 
(see <A HREF="AA-9-5-3.html">9.5.3</A>).</div>
<div class="paranum"><a name="p9">9</a></div>
<div class="Normal" style="margin-bottom: 0.4em"><A NAME="I4624"></A>For 
the execution of a requeue on an entry of a target protected object, 
after leaving the enclosing callable construct:&nbsp;</div>
<div class="paranum"><a name="p10">10</a></div>
<div class="Bulleted">if the requeue is an internal requeue (that is, 
the requeue is back on an entry of the same protected object &mdash; 
see <A HREF="AA-9-5.html">9.5</A>), the call is added to the queue of 
the named entry and the ongoing protected action continues (see <A HREF="AA-9-5-1.html">9.5.1</A>); 
</div>
<div class="paranum"><a name="p10.a">10.a</a></div>
<div class="Annotations"><B>Ramification:&nbsp;</B>Note that for an internal 
requeue, the call is queued without checking whether the target entry 
is open. This is because the entry queues will be serviced before the 
current protected action completes anyway, and considering the requeued 
call immediately might allow it to &quot;jump&quot; ahead of existing 
callers on the same queue.&nbsp;</div>
<div class="paranum"><a name="p11">11</a></div>
<div class="Bulleted">if the requeue is an external requeue (that is, 
the target protected object is not implicitly the same as the current 
object &mdash; see <A HREF="AA-9-5.html">9.5</A>), a protected action 
is started on the target object and proceeds as for a normal entry call 
(see <A HREF="AA-9-5-3.html">9.5.3</A>).&nbsp;</div>
<div class="paranum"><a name="p12">12/3</a></div>
<div class="Normal">&nbsp;{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0030-2.TXT">AI05-0030-2</A></I>} 
If the <span class="insert3">requeue target</span><span class="delete3">&nbsp;new 
entry</span> named in the <SPAN Class="swiss"><A HREF="AA-9-5-4.html#S0226">requeue_statement</A></SPAN> 
has formal parameters, then during the execution of the <SPAN Class="swiss"><A HREF="AA-9-5-2.html#S0219">accept_statement</A></SPAN> 
or <SPAN Class="swiss"><A HREF="AA-9-5-2.html#S0221">entry_body</A></SPAN> 
corresponding to the new entry, the formal parameters denote the same 
objects as did the corresponding formal parameters of the callable construct 
completed by the requeue. [In any case, no parameters are specified in 
a <SPAN Class="swiss"><A HREF="AA-9-5-4.html#S0226">requeue_statement</A></SPAN>; 
any parameter passing is implicit.]</div>
<div class="paranum"><a name="p13">13</a></div>
<div class="Normal" style="margin-bottom: 0.4em"><A NAME="I4625"></A>If 
the <SPAN Class="swiss"><A HREF="AA-9-5-4.html#S0226">requeue_statement</A></SPAN> 
includes the reserved words <B>with abort</B> (it is a <I>requeue-with-abort</I>), 
then:&nbsp;</div>
<div class="paranum"><a name="p14">14</a></div>
<div class="Bulleted">if the original entry call has been aborted (see 
<A HREF="AA-9-8.html">9.8</A>), then the requeue acts as an abort completion 
point for the call, and the call is cancelled and no requeue is performed;</div>
<div class="paranum"><a name="p15">15</a></div>
<div class="Bulleted">if the original entry call was timed (or conditional), 
then the original expiration time is the expiration time for the requeued 
call.&nbsp;</div>
<div class="paranum"><a name="p16">16</a></div>
<div class="Normal">If the reserved words <B>with abort</B> do not appear, 
then the call remains protected against cancellation while queued as 
the result of the <SPAN Class="swiss"><A HREF="AA-9-5-4.html#S0226">requeue_statement</A></SPAN>. 
</div>
<div class="paranum"><a name="p16.a">16.a</a></div>
<div class="Annotations"><B>Ramification:&nbsp;</B>This protection against 
cancellation lasts only until the call completes or a subsequent requeue-with-abort 
is performed on the call.&nbsp;</div>
<div class="paranum"><a name="p16.b">16.b</a></div>
<div class="Annotations"><B>Reason:&nbsp;</B>We chose to protect a requeue, 
by default, against abort or cancellation. This seemed safer, since it 
is likely that extra steps need to be taken to allow for possible cancellation 
once the servicing of an entry call has begun. This also means that in 
the absence of <B>with abort</B> the usual Ada 83 behavior is preserved, 
namely that once an entry call is accepted, it cannot be cancelled until 
it completes.&nbsp;</div>
<div class="NotesHeader">NOTES</div>
<div class="paranum"><a name="p17">17</a></div>
<div class="Notes">32&nbsp;&nbsp;A requeue is permitted from a single 
entry to an entry of an entry family, or vice-versa. The entry index, 
if any, plays no part in the subtype conformance check between the profiles 
of the two entries; an entry index is part of the <I>entry_</I><SPAN Class="swiss"><A HREF="AA-4-1.html#S0091">name</A></SPAN> 
for an entry of a family. <A NAME="I4626"></A></div>

<H4 Class="centered">Examples</H4>
<div class="paranum"><a name="p18">18</a></div>
<div class="Normal" style="margin-bottom: 0.4em"><I>Examples of requeue 
statements:</I>&nbsp;</div>
<div class="paranum"><a name="p19">19</a></div>
<div class="Examples"><B>requeue</B>&nbsp;Request(Medium)&nbsp;<B>with&nbsp;abort</B>;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--<SPAN Class="roman"><I>&nbsp;requeue&nbsp;on&nbsp;a&nbsp;member&nbsp;of&nbsp;an&nbsp;entry&nbsp;family&nbsp;of&nbsp;the&nbsp;current&nbsp;task,&nbsp;see&nbsp;<A HREF="AA-9-1.html">9.1</A></I></SPAN></div>
<div class="paranum"><a name="p20">20</a></div>
<div class="Examples"><B>requeue</B>&nbsp;Flags(I).Seize;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--<SPAN Class="roman"><I>&nbsp;requeue&nbsp;on&nbsp;an&nbsp;entry&nbsp;of&nbsp;an&nbsp;array&nbsp;component,&nbsp;see&nbsp;<A HREF="AA-9-4.html">9.4</A></I></SPAN></div>

<H4 Class="centered">Extensions to Ada 83</H4>
<div class="paranum"><a name="p20.a">20.a</a></div>
<div class="Annotations"><A NAME="I4627"></A>The <SPAN Class="swiss"><A HREF="AA-9-5-4.html#S0226">requeue_statement</A></SPAN> 
is new.&nbsp;</div>

<H4 Class="centered">Extensions to Ada 2005</H4>
<div class="paranum"><a name="p20.b">20.b/3</a></div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0030-2.TXT">AI05-0030-2</A></I>} 
<span class="insert3"></span>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0215-1.TXT">AI05-0215-1</A></I>} 
<span class="insert3"><A NAME="I4628"></A>Added the ability to requeue 
on operations of synchronized interfaces that are declared to be an entry.</span> 
</div>

</div>
<div class="navig"><A HREF="AA-TOC.html">Contents</A>&nbsp;
&nbsp;<A HREF="AA-0-4.html">Index</A>&nbsp;
&nbsp;<A HREF="AA-STDS.html">References</A>&nbsp;
&nbsp;<A HREF="AA-SRCH.html">Search</A>&nbsp;
&nbsp;<A HREF="AA-9-5-3.html">Previous</A>&nbsp;
&nbsp;<A HREF="AA-9-6.html">Next</A>&nbsp;
</div>
<DIV Style="margin-top:0.0em">
<SPAN Style="vertical-align: middle; font-size:120%">Ada 2005 and 2012 Editions sponsored in part by <SPAN Style="font-size: 125%"><A HREF="http://www.ada-europe.org/"><B>Ada-Europe</B></A></SPAN></SPAN></DIV>
</BODY>
</HTML>
