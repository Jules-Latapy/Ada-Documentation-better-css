<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<HTML>
<HEAD>
    <TITLE>Return Statements</TITLE>
    <META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
    <META NAME="Author" CONTENT="JTC1/SC22/WG9/ARG, by Randall Brukardt, ARG Editor">
    <META NAME="GENERATOR" CONTENT="Arm_Form.Exe, Ada Reference Manual generator">
    <link rel="stylesheet" href="../styles.css">
	<link rel="icon" href="../logo.svg">
</HEAD>
<BODY TEXT="#000000" BGCOLOR="#FFFFF0" LINK="#000080" VLINK="#330033" ALINK="#0000FF">
<DIV><B><SPAN Style="font-size:200%; color: rgb(0,51,153)">Annotated</SPAN><SPAN Style="font-size:200%; color: rgb(0,0,102)">&nbsp;Ada Reference Manual</SPAN></B> &mdash; <A HREF="AA-TTL.html"><B>Legal Information</B></A></DIV>
<div class="navig"><A HREF="AA-TOC.html">Contents</A>&nbsp;
&nbsp;<A HREF="AA-0-4.html">Index</A>&nbsp;
&nbsp;<A HREF="AA-STDS.html">References</A>&nbsp;
&nbsp;<A HREF="../RM-SRCH.html">Search</A>&nbsp;
&nbsp;<A HREF="AA-6-4-1.html">Previous</A>&nbsp;
&nbsp;<A HREF="AA-6-5-1.html">Next</A>&nbsp;
<img SRC="../logo.svg" class="adaLogo">
<img SRC="../logo.svg" class="adaLogo">
<img SRC="../logo.svg" class="adaLogo">
</div>
<div class="main">
<H1>6.5 Return Statements</H1>
<div class="paranum"><a name="p1">1/2</a></div>
<div class="Normal">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-10318.TXT">AI95-00318-02</A></I>} 
A <span class="insert2"><SPAN Class="swiss"><A HREF="AA-6-5.html#S0183">simple_return_statement</A></SPAN> 
or <SPAN Class="swiss"><A HREF="AA-6-5.html#S0186">extended_return_statement</A></SPAN> 
(collectively called a <I>return statement</I>) <A NAME="I3886"></A></span><span class="delete2"><SPAN Class="swiss"><A HREF="AA-6-5.html#S0184">return_statement</A></SPAN></span> 
is used to complete the execution of the innermost enclosing <SPAN Class="swiss"><A HREF="AA-6-3.html#S0177">subprogram_body</A></SPAN>, 
<SPAN Class="swiss"><A HREF="AA-9-5-2.html#S0221">entry_body</A></SPAN>, 
or <SPAN Class="swiss"><A HREF="AA-9-5-2.html#S0219">accept_statement</A></SPAN>. 
</div>

<H4 Class="centered">Syntax</H4>
<div class="paranum"><a name="p2">2/2</a></div>
<div class="Indented1">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-10318.TXT">AI95-00318-02</A></I>} 
<SPAN Class="swiss"></SPAN><span class="insert2"><SPAN Class="swiss">simple_return_statement</SPAN></span><SPAN Class="swiss"></SPAN><span class="delete2"><SPAN Class="swiss">&nbsp;return_statement</SPAN></span><SPAN Class="swiss"></SPAN><A NAME="I3887"></A><A NAME="S0183"></A><A NAME="S0184"></A><SPAN Class="swiss">&nbsp;::=&nbsp;</SPAN><B>return</B>&nbsp;[<A NAME="I3888"></A><SPAN Class="swiss"><A HREF="AA-4-4.html#S0117">expression</A></SPAN>];</div>
<div class="paranum"><a name="p2.1">2.1/3</a></div>
<div class="Indented1">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0277-1.TXT">AI05-0277-1</A></I>} 
<SPAN Class="swiss"></SPAN><span class="insert3"><SPAN Class="swiss">extended_return_object_declaration</SPAN></span><SPAN Class="swiss"></SPAN><A NAME="I3889"></A><A NAME="S0185"></A><span class="insert3"><SPAN Class="swiss">&nbsp;::=&nbsp;</SPAN></span><span class="insert3"><BR>
&nbsp;&nbsp;&nbsp;&nbsp;<A NAME="I3890"></A><SPAN Class="swiss"><A HREF="AA-3-1.html#S0022">defining_identifier</A></SPAN>&nbsp;:&nbsp;[<B>aliased</B>][<B>constant</B>]&nbsp;<A NAME="I3891"></A><SPAN Class="swiss"><A HREF="AA-6-5.html#S0187">return_subtype_indication</A></SPAN>&nbsp;[:=&nbsp;<A NAME="I3892"></A><SPAN Class="swiss"><A HREF="AA-4-4.html#S0117">expression</A></SPAN>]</span></div>
<div class="paranum"><a name="p2.2">2.2/3</a></div>
<div class="Indented1">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-10318.TXT">AI95-00318-02</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0015-1.TXT">AI05-0015-1</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0053-1.TXT">AI05-0053-1</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0277-1.TXT">AI05-0277-1</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0299-1.TXT">AI05-0299-1</A></I>} 
<SPAN Class="swiss"></SPAN><span class="insert2"><SPAN Class="swiss">extended_return_statement</SPAN></span><SPAN Class="swiss"></SPAN><A NAME="I3893"></A><A NAME="S0186"></A><span class="insert2"><SPAN Class="swiss">&nbsp;::=&nbsp;</SPAN></span><span class="insert2"><BR>
&nbsp;&nbsp;&nbsp;&nbsp;<B>return</B>&nbsp;</span><span class="insert3"><A NAME="I3894"></A><SPAN Class="swiss"><A HREF="AA-6-5.html#S0185">extended_return_object_declaration</A></SPAN></span><span class="insert2"></span><span class="insert2"><span class="delete3"><A NAME="I3895"></A><SPAN Class="swiss"><A HREF="AA-3-1.html#S0022">&nbsp;defining_identifier</A></SPAN>&nbsp;:&nbsp;[</span></span><span class="insert3"><span class="delete3"><B>&nbsp;constant</B></span></span><span class="insert2"><span class="delete3"><B>&nbsp;aliased</B>]&nbsp;<A NAME="I3896"></A><SPAN Class="swiss"><A HREF="AA-6-5.html#S0187">return_subtype_indication</A></SPAN>&nbsp;[:=&nbsp;<A NAME="I3897"></A><SPAN Class="swiss"><A HREF="AA-4-4.html#S0117">expression</A></SPAN>]</span></span><span class="insert2">&nbsp;[<B>do</B><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A NAME="I3898"></A><SPAN Class="swiss"><A HREF="AA-11-2.html#S0265">handled_sequence_of_statements</A></SPAN><BR>
&nbsp;&nbsp;&nbsp;&nbsp;<B>end</B>&nbsp;<B>return</B>];</span></div>
<div class="paranum"><a name="p2.3">2.3/2</a></div>
<div class="Indented1">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-10318.TXT">AI95-00318-02</A></I>} 
<SPAN Class="swiss"></SPAN><span class="insert2"><SPAN Class="swiss">return_subtype_indication</SPAN></span><SPAN Class="swiss"></SPAN><A NAME="I3899"></A><A NAME="S0187"></A><span class="insert2"><SPAN Class="swiss">&nbsp;::=&nbsp;</SPAN></span><span class="insert2"><A NAME="I3900"></A><SPAN Class="swiss"><A HREF="AA-3-2-2.html#S0027">subtype_indication</A></SPAN>&nbsp;|&nbsp;<A NAME="I3901"></A><SPAN Class="swiss"><A HREF="AA-3-10.html#S0084">access_definition</A></SPAN></span></div>

<H4 Class="centered">Name Resolution Rules</H4>
<div class="paranum"><a name="p3">3/2</a></div>
<div class="Normal">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-10318.TXT">AI95-00318-02</A></I>} 
<span class="insert2"><A NAME="I3902"></A>The <I>result subtype</I> of 
a function is the subtype denoted by the <SPAN Class="swiss"><A HREF="AA-3-2-2.html#S0028">subtype_mark</A></SPAN>, 
or defined by the <SPAN Class="swiss"><A HREF="AA-3-10.html#S0084">access_definition</A></SPAN>, 
after the reserved word <B>return</B> in the profile of the function.<A NAME="I3903"></A></span><span class="delete2"><A NAME="I3904"></A> 
The <SPAN Class="swiss"><A HREF="AA-4-4.html#S0117">expression</A></SPAN>, 
if any, of a <SPAN Class="swiss"><A HREF="AA-6-5.html#S0184">return_statement</A></SPAN> 
is called the <I>return expression</I>. <A NAME="I3905"></A>The <I>result 
subtype</I> of a function is the subtype denoted by the <SPAN Class="swiss"><A HREF="AA-3-2-2.html#S0028">subtype_mark</A></SPAN> 
after the reserved word <B>return</B> in the profile of the function.<A NAME="I3906"></A></span> 
The expected type for <span class="insert2">the <SPAN Class="swiss"><A HREF="AA-4-4.html#S0117">expression</A></SPAN>, 
if any, of a <SPAN Class="swiss"><A HREF="AA-6-5.html#S0183">simple_return_statement</A></SPAN></span><span class="delete2">&nbsp;a 
return expression</span> is the result type of the corresponding function.<span class="insert2">&nbsp;<A NAME="I3907"></A>The expected type for the <SPAN Class="swiss"><A HREF="AA-4-4.html#S0117">expression</A></SPAN> 
of an <SPAN Class="swiss"><A HREF="AA-6-5.html#S0186">extended_return_statement</A></SPAN> 
is that of the <SPAN Class="swiss"><A HREF="AA-6-5.html#S0187">return_subtype_indication</A></SPAN>.</span> 
</div>
<div class="paranum"><a name="p3.a">3.a</a></div>
<div class="Annotations"><B>To be honest:&nbsp;</B>The same applies to generic 
functions.&nbsp;</div>

<H4 Class="centered">Legality Rules</H4>
<div class="paranum"><a name="p4">4/2</a></div>
<div class="Normal">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-10318.TXT">AI95-00318-02</A></I>} 
<span class="insert2"><A NAME="I3908"></A></span><span class="delete2"><A NAME="I3909"></A></span>A 
<span class="insert2">return statement</span><span class="delete2"><SPAN Class="swiss"><A HREF="AA-6-5.html#S0184">&nbsp;return_statement</A></SPAN></span> 
shall be within a callable construct, and it <I>applies to</I> the innermost 
<span class="insert2">callable construct or <SPAN Class="swiss"><A HREF="AA-6-5.html#S0186">extended_return_statement</A></SPAN> 
that contains it</span><span class="delete2">&nbsp;one</span>. A <span class="insert2">return 
statement</span><span class="delete2"><SPAN Class="swiss"><A HREF="AA-6-5.html#S0184">&nbsp;return_statement</A></SPAN></span> 
shall not be within a body that is within the construct to which the 
<span class="insert2">return statement</span><span class="delete2"><SPAN Class="swiss"><A HREF="AA-6-5.html#S0184">&nbsp;return_statement</A></SPAN></span> 
applies.</div>
<div class="paranum"><a name="p5">5/3</a></div>
<div class="Normal">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-10318.TXT">AI95-00318-02</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0015-1.TXT">AI05-0015-1</A></I>} 
A function body shall contain at least one <span class="insert2">return 
statement</span><span class="delete2"><SPAN Class="swiss"><A HREF="AA-6-5.html#S0184">&nbsp;return_statement</A></SPAN></span> 
that applies to the function body, unless the function contains <SPAN Class="swiss"><A HREF="AA-13-8.html#S0317">code_statement</A></SPAN>s. 
A <span class="insert2"><SPAN Class="swiss"><A HREF="AA-6-5.html#S0183">simple_return_statement</A></SPAN></span><span class="delete2"><SPAN Class="swiss"><A HREF="AA-6-5.html#S0184">&nbsp;return_statement</A></SPAN></span> 
shall include <span class="insert2">an <SPAN Class="swiss"><A HREF="AA-4-4.html#S0117">expression</A></SPAN></span><span class="delete2">&nbsp;a 
return expression</span> if and only if it applies to a function body.<span class="insert2">&nbsp;An <SPAN Class="swiss"><A HREF="AA-6-5.html#S0186">extended_return_statement</A></SPAN> 
shall apply to a function body.</span><span class="insert3">&nbsp;An <SPAN Class="swiss"><A HREF="AA-6-5.html#S0186">extended_return_statement</A></SPAN> 
with the reserved word <B>constant</B> shall include an <SPAN Class="swiss"><A HREF="AA-4-4.html#S0117">expression</A></SPAN>.</span></div>
<div class="paranum"><a name="p5.a">5.a/2</a></div>
<div class="Annotations"><B>Reason:&nbsp;</B>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-10318.TXT">AI95-00318-02</A></I>} 
The requirement that a function body has to have at least one <span class="insert2">return 
statement</span><span class="delete2"><SPAN Class="swiss"><A HREF="AA-6-5.html#S0184">&nbsp;return_statement</A></SPAN></span> 
is a &ldquo;helpful&rdquo; restriction. There <span class="insert2">has</span><span class="delete2">&nbsp;was</span> 
been some interest in lifting this restriction, or allowing a raise statement 
to substitute for the <span class="insert2">return statement</span><span class="delete2"><SPAN Class="swiss"><A HREF="AA-6-5.html#S0184">&nbsp;return_statement</A></SPAN></span>. 
However, there was enough interest in leaving it as is that we decided 
not to change it.&nbsp;</div>
<div class="paranum"><a name="p5.b">5.b/2</a></div>
<div class="Annotations"><span class="insert2"><B>Ramification:&nbsp;</B></span>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-10318.TXT">AI95-00318-02</A></I>} 
<span class="insert2">A return statement can apply to an <SPAN Class="swiss"><A HREF="AA-6-5.html#S0186">extended_return_statement</A></SPAN>, 
so a <SPAN Class="swiss"><A HREF="AA-6-5.html#S0183">simple_return_statement</A></SPAN> 
without an <SPAN Class="swiss"><A HREF="AA-4-4.html#S0117">expression</A></SPAN> 
can be given in one. However, neither <SPAN Class="swiss"><A HREF="AA-6-5.html#S0183">simple_return_statement</A></SPAN> 
with an <SPAN Class="swiss"><A HREF="AA-4-4.html#S0117">expression</A></SPAN> 
nor an <SPAN Class="swiss"><A HREF="AA-6-5.html#S0186">extended_return_statement</A></SPAN> 
can be given inside an <SPAN Class="swiss"><A HREF="AA-6-5.html#S0186">extended_return_statement</A></SPAN>, 
as they must apply (directly) to a function body.</span>&nbsp;</div>
<div class="paranum"><a name="p5.1">5.1/2</a></div>
<div class="Normal" style="margin-bottom: 0.4em">&nbsp;&nbsp;{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-10318.TXT">AI95-00318-02</A></I>} 
<span class="insert2">For an <SPAN Class="swiss"><A HREF="AA-6-5.html#S0186">extended_return_statement</A></SPAN> 
that applies to a function body:</span></div>
<div class="paranum"><a name="p5.2">5.2/3</a></div>
<div class="Bulleted">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-10318.TXT">AI95-00318-02</A></I>} 
<span class="insert2"></span>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0032-1.TXT">AI05-0032-1</A></I>} 
<span class="insert2"></span>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0103-1.TXT">AI05-0103-1</A></I>} 
<span class="insert2">If the result subtype of the function is defined 
by a <SPAN Class="swiss"><A HREF="AA-3-2-2.html#S0028">subtype_mark</A></SPAN>, 
the <SPAN Class="swiss"><A HREF="AA-6-5.html#S0187">return_subtype_indication</A></SPAN> 
shall be a <SPAN Class="swiss"><A HREF="AA-3-2-2.html#S0027">subtype_indication</A></SPAN>. 
The type of the <SPAN Class="swiss"><A HREF="AA-3-2-2.html#S0027">subtype_indication</A></SPAN> 
shall be</span><span class="insert3">&nbsp;covered by</span><span class="insert2">&nbsp;the result type of the function.&nbsp;</span><span class="insert3">The</span><span class="insert2"></span><span class="insert2"><span class="delete3">&nbsp;If 
the result subtype of the function is constrained, then the</span></span><span class="insert2">&nbsp;subtype defined by the <SPAN Class="swiss"><A HREF="AA-3-2-2.html#S0027">subtype_indication</A></SPAN> 
shall&nbsp;</span><span class="insert3">be statically compatible with the 
result subtype of the function; if the result type of the function is 
elementary, the two subtypes</span><span class="insert2"></span><span class="insert2"><span class="delete3">&nbsp;also 
be constrained and</span></span><span class="insert2">&nbsp;shall statically 
match</span><span class="insert2"><span class="delete3">&nbsp;this result 
subtype</span></span><span class="insert2">.<A NAME="I3910"></A> If the 
result subtype of the function is&nbsp;</span><span class="insert3">indefinite</span><span class="insert2"></span><span class="insert2"><span class="delete3">&nbsp;unconstrained</span></span><span class="insert2">, 
then the subtype defined by the <SPAN Class="swiss"><A HREF="AA-3-2-2.html#S0027">subtype_indication</A></SPAN> 
shall be a definite subtype, or there shall be an <SPAN Class="swiss"><A HREF="AA-4-4.html#S0117">expression</A></SPAN>.</span></div>
<div class="paranum"><a name="p5.3">5.3/2</a></div>
<div class="Bulleted">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-10318.TXT">AI95-00318-02</A></I>} 
<span class="insert2">If the result subtype of the function is defined 
by an <SPAN Class="swiss"><A HREF="AA-3-10.html#S0084">access_definition</A></SPAN>, 
the <SPAN Class="swiss"><A HREF="AA-6-5.html#S0187">return_subtype_indication</A></SPAN> 
shall be an <SPAN Class="swiss"><A HREF="AA-3-10.html#S0084">access_definition</A></SPAN>. 
The subtype defined by the <SPAN Class="swiss"><A HREF="AA-3-10.html#S0084">access_definition</A></SPAN> 
shall statically match the result subtype of the function. The accessibility 
level of this anonymous access subtype is that of the result subtype.</span></div>
<div class="paranum"><a name="p5.4">5.4/3</a></div>
<div class="Bulleted">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0032-1.TXT">AI05-0032-1</A></I>} 
<span class="insert3">If the result subtype of the function is class-wide, 
the accessibility level of the type of the subtype defined by the <SPAN Class="swiss"><A HREF="AA-6-5.html#S0187">return_subtype_indication</A></SPAN> 
shall not be statically deeper than that of the master that elaborated 
the function body.</span>&nbsp;</div>
<div class="paranum"><a name="p5.b.1">5.b.1/3</a></div>
<div class="Annotations"><span class="insert3"><B>Reason:&nbsp;</B>In this 
case, the <SPAN Class="swiss"><A HREF="AA-6-5.html#S0187">return_subtype_indication</A></SPAN> 
could be a specific type initialized by default; in that case there is 
no <SPAN Class="swiss"><A HREF="AA-4-4.html#S0117">expression</A></SPAN> 
to check.</span>&nbsp;</div>
<div class="paranum"><a name="p5.5">5.5/3</a></div>
<div class="Normal" style="margin-bottom: 0.4em">&nbsp;&nbsp;{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-10318.TXT">AI95-00318-02</A></I>} 
<span class="insert2"></span>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0032-1.TXT">AI05-0032-1</A></I>} 
<span class="insert2">For any return statement that applies to a function 
body:</span></div>
<div class="paranum"><a name="p5.6">5.6/3</a></div>
<div class="Bulleted">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-10318.TXT">AI95-00318-02</A></I>} 
<span class="insert2"></span>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0188-1.TXT">AI05-0188-1</A></I>} 
<span class="insert2">[If the result subtype of the function is limited, 
then the <SPAN Class="swiss"><A HREF="AA-4-4.html#S0117">expression</A></SPAN> 
of the return statement (if any) shall&nbsp;</span><span class="insert3">meet 
the restrictions described in <A HREF="AA-7-5.html">7.5</A></span><span class="insert2"></span><span class="insert2"><span class="delete3">&nbsp;be 
an <SPAN Class="swiss"><A HREF="AA-4-3.html#S0106">aggregate</A></SPAN>, 
a function call (or equivalent use of an operator), or a <SPAN Class="swiss"><A HREF="AA-4-7.html#S0142">qualified_expression</A></SPAN> 
or parenthesized expression whose operand is one of these</span></span><span class="insert2">.]</span> 
</div>
<div class="paranum"><a name="p5.c">5.c/3</a></div>
<div class="Annotations"><SPAN STYLE="font-size: 80%"><I>This paragraph 
was deleted.</I></SPAN><span class="delete3"><B>Discussion:&nbsp;</B></span>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0188-1.TXT">AI05-0188-1</A></I>} 
<span class="delete3"></span><span class="insert2"><span class="delete3">In 
other words, if limited, the <SPAN Class="swiss"><A HREF="AA-4-4.html#S0117">expression</A></SPAN> 
must produce a &ldquo;new&rdquo; object, rather than being the name of 
a preexisting object (which would imply copying).</span></span><span class="delete3"></span> 
</div>
<div class="paranum"><a name="p5.7">5.7/3</a></div>
<div class="Bulleted">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00416.TXT">AI95-00416-01</A></I>} 
<span class="insert2"></span>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0032-1.TXT">AI05-0032-1</A></I>} 
<span class="insert2"></span>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0051-1.TXT">AI05-0051-1</A></I>} 
<span class="insert2">If the result subtype of the function is class-wide, 
the accessibility level of the type of the <SPAN Class="swiss"><A HREF="AA-4-4.html#S0117">expression</A></SPAN> 
</span><span class="insert3">(if any)&nbsp;</span><span class="insert2">of 
the return statement shall not be statically deeper than that of the 
master that elaborated the function body.</span><span class="insert2"><span class="delete3">&nbsp;If the result subtype has one or more unconstrained access discriminants, 
the accessibility level of the anonymous access type of each access discriminant, 
as determined by the <SPAN Class="swiss"><A HREF="AA-4-4.html#S0117">expression</A></SPAN> 
of the <SPAN Class="swiss"><A HREF="AA-6-5.html#S0183">simple_return_statement</A></SPAN> 
or the <SPAN Class="swiss"><A HREF="AA-6-5.html#S0187">return_subtype_indication</A></SPAN>, 
shall not be statically deeper than that of the master that elaborated 
the function body.</span></span><span class="insert2"></span></div>
<div class="paranum"><a name="p5.d">5.d/3</a></div>
<div class="Annotations"><span class="insert2"><B>Discussion:&nbsp;</B></span>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0032-1.TXT">AI05-0032-1</A></I>} 
<span class="insert2"></span>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0051-1.TXT">AI05-0051-1</A></I>} 
<span class="insert2"></span><span class="insert3">If</span><span class="insert2"></span><span class="insert2"><span class="delete3">&nbsp;We 
know that if</span></span><span class="insert2">&nbsp;the result type is class 
wide, then there must be an <SPAN Class="swiss"><A HREF="AA-4-4.html#S0117">expression</A></SPAN> 
of the return statement</span><span class="insert3">&nbsp;unless this is an 
<SPAN Class="swiss"><A HREF="AA-6-5.html#S0186">extended_return_statement</A></SPAN> 
whose <SPAN Class="swiss"><A HREF="AA-6-5.html#S0187">return_subtype_indication</A></SPAN> 
is a specific type. We have a separate rule to cover that case. Note 
that if an <SPAN Class="swiss"><A HREF="AA-6-5.html#S0186">extended_return_statement</A></SPAN> 
has an <SPAN Class="swiss"><A HREF="AA-4-4.html#S0117">expression</A></SPAN>, 
then both this rule and the next one must be satisfied</span><span class="insert2"></span><span class="insert2"><span class="delete3">. 
Similarly, if the result subtype is unconstrained, then either the <SPAN Class="swiss"><A HREF="AA-6-5.html#S0187">return_subtype_indication</A></SPAN> 
(if any) is constrained, or there must be an <SPAN Class="swiss"><A HREF="AA-4-4.html#S0117">expression</A></SPAN></span></span><span class="insert2">.</span> 
</div>
<div class="paranum"><a name="p5.8">5.8/3</a></div>
<div class="Bulleted">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0051-1.TXT">AI05-0051-1</A></I>} 
<span class="insert3">If the subtype determined by the <SPAN Class="swiss"><A HREF="AA-4-4.html#S0117">expression</A></SPAN> 
of the <SPAN Class="swiss"><A HREF="AA-6-5.html#S0183">simple_return_statement</A></SPAN> 
or by the <SPAN Class="swiss"><A HREF="AA-6-5.html#S0187">return_subtype_indication</A></SPAN> 
has one or more access discriminants, the accessibility level of the 
anonymous access type of each access discriminant shall not be statically 
deeper than that of the master that elaborated the function body.</span></div>
<div class="paranum"><a name="p5.d.1">5.d.1/3</a></div>
<div class="Annotations"><span class="insert3"><B>Discussion:&nbsp;</B>We 
use the type used by the return statement rather than from the function 
return type since we want to check whenever the return object has access 
discriminants, even if the function return type doesn't have any (mostly 
for a class-wide type).</span>&nbsp;</div>
<div class="paranum"><a name="p5.9">5.9/3</a></div>
<div class="Normal">&nbsp;&nbsp;{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0277-1.TXT">AI05-0277-1</A></I>} 
<span class="insert3">If the keyword <B>aliased</B> is present in an 
<SPAN Class="swiss"><A HREF="AA-6-5.html#S0185">extended_return_object_declaration</A></SPAN>, 
the type of the extended return object shall be immutably limited.</span> 
</div>

<H4 Class="centered">Static Semantics</H4>
<div class="paranum"><a name="p5.10">5.10/3</a></div>
<div class="Normal">&nbsp;&nbsp;&nbsp;{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-10318.TXT">AI95-00318-02</A></I>} 
<span class="insert2"></span>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0015-1.TXT">AI05-0015-1</A></I>} 
<span class="insert2"></span>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0144-2.TXT">AI05-0144-2</A></I>} 
<span class="insert2"><A NAME="I3911"></A>Within an <SPAN Class="swiss"><A HREF="AA-6-5.html#S0186">extended_return_statement</A></SPAN>, 
the <I>return object</I> is declared with the given <SPAN Class="swiss"><A HREF="AA-3-1.html#S0022">defining_identifier</A></SPAN>, 
with the nominal subtype defined by the <SPAN Class="swiss"><A HREF="AA-6-5.html#S0187">return_subtype_indication</A></SPAN>.</span><span class="insert3">&nbsp;An <SPAN Class="swiss"><A HREF="AA-6-5.html#S0186">extended_return_statement</A></SPAN> 
with the reserved word <B>constant</B> is a full constant declaration 
that declares the return object to be a constant object.</span><span class="insert2"></span> 
</div>

<H4 Class="centered">Dynamic Semantics</H4>
<div class="paranum"><a name="p5.11">5.11/3</a></div>
<div class="Normal">&nbsp;&nbsp;&nbsp;{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-10318.TXT">AI95-00318-02</A></I>} 
<span class="insert2"></span>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00416.TXT">AI95-00416-01</A></I>} 
<span class="insert2"></span>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0032-1.TXT">AI05-0032-1</A></I>} 
<span class="insert2"><A NAME="I3912"></A>For the execution of an <SPAN Class="swiss"><A HREF="AA-6-5.html#S0186">extended_return_statement</A></SPAN>, 
the <SPAN Class="swiss"><A HREF="AA-3-2-2.html#S0027">subtype_indication</A></SPAN> 
or <SPAN Class="swiss"><A HREF="AA-3-10.html#S0084">access_definition</A></SPAN> 
is elaborated. This creates the nominal subtype of the return object. 
If there is an <SPAN Class="swiss"><A HREF="AA-4-4.html#S0117">expression</A></SPAN>, 
it is evaluated and converted to the nominal subtype (which might raise 
Constraint_Error &mdash; see <A HREF="AA-4-6.html">4.6</A><A NAME="I3913"></A>); 
the return object is created and the converted value is assigned to the 
return object. Otherwise, the return object is created and initialized 
by default as for a stand-alone object of its nominal subtype (see <A HREF="AA-3-3-1.html">3.3.1</A>). 
If the nominal subtype is indefinite, the return object is constrained 
by its initial value.<A NAME="I3914"></A><A NAME="I3915"></A></span><span class="insert3">&nbsp;A check is made that the value of the return object belongs to the function 
result subtype. Constraint_Error is raised if this check fails.<A NAME="I3916"></A> 
<A NAME="I3917"></A><A NAME="I3918"></A></span><span class="insert2"></span></div>
<div class="paranum"><a name="p5.e">5.e/2</a></div>
<div class="Annotations"><span class="insert2"><B>Ramification:&nbsp;</B>If 
the result type is controlled or has a controlled part, appropriate calls 
on Initialize or Adjust are performed prior to executing the <SPAN Class="swiss"><A HREF="AA-11-2.html#S0265">handled_sequence_of_statements</A></SPAN>, 
except when the initial expression is an <SPAN Class="swiss"><A HREF="AA-4-3.html#S0106">aggregate</A></SPAN> 
(which requires build-in-place with no call on Adjust).</span></div>
<div class="paranum"><a name="p5.f">5.f/3</a></div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0005-1.TXT">AI05-0005-1</A></I>} 
<span class="insert2">If the return statement is left without resulting 
in a return (for example, due to an exception propagated from the <SPAN Class="swiss"><A HREF="AA-4-4.html#S0117">expression</A></SPAN> 
or the <SPAN Class="swiss"><A HREF="AA-11-2.html#S0265">handled_sequence_of_statements</A></SPAN>, 
or a goto out of the <SPAN Class="swiss"><A HREF="AA-11-2.html#S0265">handled_sequence_of_statements</A></SPAN>), 
</span><span class="insert3">if&nbsp;</span><span class="insert2">the return 
object&nbsp;</span><span class="insert3">has been created, it&nbsp;</span><span class="insert2">is 
finalized prior to leaving the return statement.</span><span class="insert3">&nbsp;If it has not been created when the return statement is left, it is not 
created or finalized.</span><span class="insert2"></span></div>
<div class="paranum"><a name="p5.g">5.g/3</a></div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0032-1.TXT">AI05-0032-1</A></I>} 
<span class="insert3">Other rules ensure that the check required by this 
rule cannot fail unless the function has a class-wide result subtype 
where the associated specific subtype is constrained. In other cases, 
either the subtypes have to match or the function's subtype is unconstrained 
and needs no checking.</span>&nbsp;</div>
<div class="paranum"><a name="p6">6/2</a></div>
<div class="Normal">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-10318.TXT">AI95-00318-02</A></I>} 
<span class="insert2"><A NAME="I3919"></A></span><span class="delete2"><A NAME="I3920"></A></span>For 
the execution of a <span class="insert2"><SPAN Class="swiss"><A HREF="AA-6-5.html#S0183">simple_return_statement</A></SPAN></span><span class="delete2"><SPAN Class="swiss"><A HREF="AA-6-5.html#S0184">&nbsp;return_statement</A></SPAN></span>, 
the <SPAN Class="swiss"><A HREF="AA-4-4.html#S0117">expression</A></SPAN> 
(if any) is first evaluated<span class="insert2">,</span><span class="delete2">&nbsp;and</span> converted to the result subtype<span class="insert2">, and 
then is assigned to the anonymous <I>return object</I>. <A NAME="I3921"></A></span><span class="delete2">.</span> 
<A NAME="I3922"></A></div>
<div class="paranum"><a name="p6.a">6.a</a></div>
<div class="Annotations"><B>Ramification:&nbsp;</B>The conversion might raise 
Constraint_Error &mdash; (see <A HREF="AA-4-6.html">4.6</A>).&nbsp;</div>
<div class="paranum"><a name="p7">7/2</a></div>
<div class="Normal">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-10318.TXT">AI95-00318-02</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00416.TXT">AI95-00416-01</A></I>} 
<span class="insert2">[If the return object has any parts that are tasks, 
the activation of those tasks does not occur until after the function 
returns (see <A HREF="AA-9-2.html">9.2</A>).]</span><span class="delete2">&nbsp;If 
the result type is class-wide, then the tag of the result is the tag 
of the value of the <SPAN Class="swiss"><A HREF="AA-4-4.html#S0117">expression</A></SPAN>.</span> 
</div>
<div class="paranum"><a name="p7.a">7.a/2</a></div>
<div class="Annotations"><span class="insert2"><B>Proof:&nbsp;</B>This is 
specified by the rules in <A HREF="AA-9-2.html">9.2</A>.</span>&nbsp;</div>
<div class="paranum"><a name="p7.b">7.b/2</a></div>
<div class="Annotations"><span class="insert2"><B>Reason:&nbsp;</B>Only the 
caller can know when task activations should take place, as it depends 
on the context of the call. If the function is being used to initialize 
the component of some larger object, then that entire object must be 
initialized before any task activations. Even after the outer object 
is fully initialized, task activations are still postponed until the 
<B>begin</B> at the end of the declarative part if the function is being 
used to initialize part of a declared object.</span>&nbsp;</div>
<div class="paranum"><a name="p8">8/3</a></div>
<div class="Normal" style="margin-bottom: 0.4em">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-10318.TXT">AI95-00318-02</A></I>} 
<span class="delete2"></span>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00344.TXT">AI95-00344-01</A></I>} 
<span class="delete2"></span>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0024-1.TXT">AI05-0024-1</A></I>} 
<span class="delete2"></span>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0032-1.TXT">AI05-0032-1</A></I>} 
<span class="delete2"></span>If the result type <span class="insert2">of 
a function&nbsp;</span>is a specific tagged type<span class="insert2">, the 
tag of the return object is that of the result type. If the result type 
is class-wide, the tag of the return object is that of&nbsp;</span><span class="insert3">the 
type of the <SPAN Class="swiss"><A HREF="AA-3-2-2.html#S0027">subtype_indication</A></SPAN> 
if it is specific, or otherwise that of&nbsp;</span><span class="insert2">the 
value of the&nbsp;</span><span class="insert3"><SPAN Class="swiss"><A HREF="AA-4-4.html#S0117">expression</A></SPAN></span><span class="insert2"></span><span class="insert2"><span class="delete3">&nbsp;expression</span></span><span class="insert2">. 
A check is made that the&nbsp;</span><span class="insert3">master</span><span class="insert2"></span><span class="insert2"><span class="delete3">&nbsp;accessibility 
level</span></span><span class="insert2">&nbsp;of the type identified by the 
tag of the result&nbsp;</span><span class="insert3">includes the elaboration</span><span class="insert2"></span><span class="insert2"><span class="delete3">&nbsp;is 
not deeper than that</span></span><span class="insert2">&nbsp;of the master 
that elaborated the function body. If this check fails, Program_Error 
is raised.<A NAME="I3923"></A> <A NAME="I3924"></A><A NAME="I3925"></A></span><span class="delete2">:</span></div>
<div class="paranum"><a name="p8.a">8.a/2</a></div>
<div class="Annotations"><span class="insert2"><B>Ramification:&nbsp;</B></span>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-10318.TXT">AI95-00318-02</A></I>} 
<span class="insert2">The first sentence is true even if the tag of the 
<SPAN Class="swiss"><A HREF="AA-4-4.html#S0117">expression</A></SPAN> 
is different, which could happen if the <SPAN Class="swiss"><A HREF="AA-4-4.html#S0117">expression</A></SPAN> 
were a view conversion or a dereference of an access value. Note that 
for a limited type, because of the restriction to <SPAN Class="swiss"><A HREF="AA-4-3.html#S0106">aggregate</A></SPAN>s 
and function calls (and no conversions), the tag will already match</span>. 
</div>
<div class="paranum"><a name="p8.b">8.b/2</a></div>
<div class="Annotations"><span class="insert2"><B>Reason:&nbsp;</B></span>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-10318.TXT">AI95-00318-02</A></I>} 
<span class="insert2">The first rule ensures that a function whose result 
type is a specific tagged type always returns an object whose tag is 
that of the result type. This is important for dispatching on controlling 
result, and allows the caller to allocate the appropriate amount of space 
to hold the value being returned (assuming there are no discriminants).</span></div>
<div class="paranum"><a name="p8.c">8.c/3</a></div>
<div class="Annotations"><span class="insert2">The&nbsp;</span><span class="insert3">master 
</span><span class="insert2">check prevents the returned object from 
outliving its type. Note that this check cannot fail for a specific tagged 
type, as the tag represents the function's type, which necessarily must 
be declared outside of the function.</span></div>
<div class="paranum"><a name="p8.d">8.d/3</a></div>
<div class="Annotations"><span class="insert3">We can't use the normal 
accessibility level &ldquo;deeper than&rdquo; check here because we may 
have &ldquo;incomparable&rdquo; levels if the masters belong to two different 
tasks. This can happen when an accept statement calls a function declared 
in the enclosing task body, and the function returns an object passed 
to it from the accept statement, and this object was itself a parameter 
to the accept statement.</span></div>
<div class="paranum"><a name="p8.1">8.1/3</a></div>
<div class="Normal">&nbsp;&nbsp;{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0073-1.TXT">AI05-0073-1</A></I>} 
<span class="insert3"><A NAME="I3926"></A><A NAME="I3927"></A>If the 
result subtype of the function is defined by an <SPAN Class="swiss"><A HREF="AA-3-10.html#S0084">access_definition</A></SPAN> 
designating a specific tagged type <I>T</I>, a check is made that the 
result value is null or the tag of the object designated by the result 
value identifies <I>T</I>. <A NAME="I3928"></A>Constraint_Error is raised 
if this check fails.</span>&nbsp;</div>
<div class="paranum"><a name="p8.e">8.e/3</a></div>
<div class="Annotations"><span class="insert3"><B>Reason:&nbsp;</B>This check 
is needed so that dispatching on controlling access results works for 
tag-indeterminate functions. If it was not made, it would be possible 
for such functions to return an access to a descendant type, meaning 
the function could return an object with a tag different than the one 
assumed by the dispatching rules.</span>&nbsp;</div>
<div class="Normal"><span class="insert2"><SPAN STYLE="font-size: 80%"><I>Paragraphs 
9 through 20 were deleted.</I></SPAN></span>&nbsp;</div>
<div class="paranum"><a name="p9">9/2</a></div>
<div class="Bulleted">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-10318.TXT">AI95-00318-02</A></I>} 
<span class="delete2"><A NAME="I3929"></A><A NAME="I3930"></A>If it is 
limited, then a check is made that the tag of the value of the return 
expression identifies the result type. <A NAME="I3931"></A>Constraint_Error 
is raised if this check fails.</span></div>
<div class="paranum"><a name="p10">10/2</a></div>
<div class="Bulleted">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-10318.TXT">AI95-00318-02</A></I>} 
<span class="delete2">If it is nonlimited, then the tag of the result 
is that of the result type.</span>&nbsp;</div>
<div class="paranum"><a name="p10.a">10.a/2</a></div>
<div class="Annotations"><span class="delete2"><B>Ramification:&nbsp;</B></span>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-10318.TXT">AI95-00318-02</A></I>} 
<span class="delete2">This is true even if the tag of the return expression 
is different.</span>&nbsp;</div>
<div class="paranum"><a name="p10.b">10.b/2</a></div>
<div class="Annotations"><span class="delete2"><B>Reason:&nbsp;</B></span>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-10318.TXT">AI95-00318-02</A></I>} 
<span class="delete2">These rules ensure that a function whose result 
type is a specific tagged type always returns an object whose tag is 
that of the result type. This is important for dispatching on controlling 
result, and, if nonlimited, allows the caller to allocate the appropriate 
amount of space to hold the value being returned (assuming there are 
no discriminants).</span>&nbsp;</div>
<div class="paranum"><a name="p11">11/2</a></div>
<div class="Normal" style="margin-bottom: 0.4em">&nbsp;{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-10318.TXT">AI95-00318-02</A></I>} 
<span class="delete2"><A NAME="I3932"></A>A type is a <I>return-by-reference</I> 
type if it is a descendant of one of the following:</span>&nbsp;</div>
<div class="paranum"><a name="p12">12/2</a></div>
<div class="Bulleted">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-10318.TXT">AI95-00318-02</A></I>} 
<span class="delete2">a tagged limited type;</span></div>
<div class="paranum"><a name="p13">13/2</a></div>
<div class="Bulleted">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-10318.TXT">AI95-00318-02</A></I>} 
<span class="delete2">a task or protected type;</span></div>
<div class="paranum"><a name="p14">14/2</a></div>
<div class="Bulleted">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-10318.TXT">AI95-00318-02</A></I>} 
<span class="delete2">a nonprivate type with the reserved word <B>limited</B> 
in its declaration;</span></div>
<div class="paranum"><a name="p15">15/2</a></div>
<div class="Bulleted">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-10318.TXT">AI95-00318-02</A></I>} 
<span class="delete2">a composite type with a subcomponent of a return-by-reference 
type;</span></div>
<div class="paranum"><a name="p16">16/2</a></div>
<div class="Bulleted">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-10318.TXT">AI95-00318-02</A></I>} 
<span class="delete2">a private type whose full type is a return-by-reference 
type.</span>&nbsp;</div>
<div class="paranum"><a name="p16.a">16.a/2</a></div>
<div class="Annotations"><span class="delete2"><B>Ramification:&nbsp;</B>The 
above rules are such that there are no &quot;Ada 83&quot; types other 
than those containing tasks that are return-by-reference. This helps 
to minimize upward incompatibilities relating to return-by-reference.</span> 
</div>
<div class="paranum"><a name="p17">17/2</a></div>
<div class="Normal" style="margin-bottom: 0.4em">&nbsp;{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-10318.TXT">AI95-00318-02</A></I>} 
<span class="delete2"><A NAME="I3933"></A><A NAME="I3934"></A>If the 
result type is a return-by-reference type, then a check is made that 
the return expression is one of the following:</span>&nbsp;</div>
<div class="paranum"><a name="p18">18/2</a></div>
<div class="Bulleted">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-10318.TXT">AI95-00318-02</A></I>} 
<span class="delete2">a <SPAN Class="swiss"><A HREF="AA-4-1.html#S0091">name</A></SPAN> 
that denotes an object view whose accessibility level is not deeper than 
that of the master that elaborated the function body; or</span>&nbsp;</div>
<div class="paranum"><a name="p18.a">18.a/2</a></div>
<div class="Annotations"><span class="delete2"><B>Discussion:&nbsp;</B></span>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00316.TXT">AI95-00316-01</A></I>} 
<span class="delete2">This rule was unnecessarily confusing, and the 
parenthetical remark &quot;(or a value with an associated object, see 
6.2)&quot; was added &mdash; and then the entire concept was deleted.</span> 
</div>
<div class="paranum"><a name="p19">19/2</a></div>
<div class="Bulleted">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-10318.TXT">AI95-00318-02</A></I>} 
<span class="delete2">a parenthesized expression or <SPAN Class="swiss"><A HREF="AA-4-7.html#S0142">qualified_expression</A></SPAN> 
whose operand is one of these kinds of expressions.</span></div>
<div class="paranum"><a name="p20">20/2</a></div>
<div class="Normal">&nbsp;{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-10318.TXT">AI95-00318-02</A></I>} 
<span class="delete2"><A NAME="I3935"></A>The exception Program_Error 
is raised if this check fails.</span>&nbsp;</div>
<div class="paranum"><a name="p20.a">20.a/2</a></div>
<div class="Annotations"><span class="delete2"><B>Discussion:&nbsp;</B>Compare 
the definition of return-by-reference with that of by-reference.</span></div>
<div class="paranum"><a name="p20.b">20.b/2</a></div>
<div class="Annotations"><span class="delete2">The return-by-reference 
types are all limited types except those that are limited only because 
of a limited private type with a nonlimited untagged full type.</span> 
</div>
<div class="paranum"><a name="p20.c">20.c/2</a></div>
<div class="Annotations"><span class="delete2"><B>Reason:&nbsp;</B><A NAME="I3936"></A>This 
check can often be performed at compile time. It is defined to be a run-time 
check to avoid generic contract model problems. In a future version of 
the standard, we anticipate that function return of a local variable 
will be illegal for all limited types, eliminating the need for the run-time 
check except for dereferences of an access parameter.</span>&nbsp;</div>
<div class="paranum"><a name="p21">21/3</a></div>
<div class="Normal">&nbsp;{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-10318.TXT">AI95-00318-02</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00402.TXT">AI95-00402-01</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00416.TXT">AI95-00416-01</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0051-1.TXT">AI05-0051-1</A></I>} 
<span class="insert2">If&nbsp;</span><span class="insert3">any part of the 
specific type of the return object</span><span class="insert2"></span><span class="insert2"><span class="delete3">&nbsp;the 
result subtype</span></span><span class="insert2">&nbsp;of a function&nbsp;</span><span class="insert3">(or 
coextension thereof)&nbsp;</span><span class="insert2">has one or more&nbsp;</span><span class="insert2"><span class="delete3">unconstrained 
</span></span><span class="insert2">access discriminants</span><span class="insert3">&nbsp;whose value is not constrained by the result subtype of the function</span><span class="insert2">, 
a check is made that the accessibility level of the anonymous access 
type of each access discriminant, as determined by the <SPAN Class="swiss"><A HREF="AA-4-4.html#S0117">expression</A></SPAN> 
or the <SPAN Class="swiss"><A HREF="AA-6-5.html#S0187">return_subtype_indication</A></SPAN> 
of the&nbsp;</span><span class="insert3">return statement</span><span class="insert2"></span><span class="insert2"><span class="delete3">&nbsp;function</span></span><span class="insert2">, 
is not deeper than&nbsp;</span><span class="insert3">the level of the master 
of the call (see <A HREF="AA-3-10-2.html">3.10.2</A>)</span><span class="insert2"></span><span class="insert2"><span class="delete3">&nbsp;that 
of the master that elaborated the function body</span></span><span class="insert2">. 
If this check fails, Program_Error is raised. <A NAME="I3937"></A><A NAME="I3938"></A><A NAME="I3939"></A></span><span class="delete2">For 
a function with a return-by-reference result type the result is returned 
by reference; that is, the function call denotes a constant view of the 
object associated with the value of the return expression. <A NAME="I3940"></A>For 
any other function, the result is returned by copy; that is, the converted 
value is assigned into an anonymous constant created at the point of 
the <SPAN Class="swiss"><A HREF="AA-6-5.html#S0184">return_statement</A></SPAN>, 
and the function call denotes that object.</span>&nbsp;</div>
<div class="paranum"><a name="p21.a">21.a/2</a></div>
<div class="Annotations"><SPAN STYLE="font-size: 80%"><I>This paragraph 
was deleted.</I></SPAN><span class="delete2"><B>Ramification:&nbsp;</B>The 
assignment operation does the necessary value adjustment, as described 
in <A HREF="AA-7-6.html">7.6</A>, &ldquo;<A HREF="AA-7-6.html">Assignment 
and Finalization</A>&rdquo;. <A HREF="AA-7-6-1.html">7.6.1</A> describes 
when the anonymous constant is finalized.</span>&nbsp;</div>
<div class="paranum"><a name="p21.b">21.b/2</a></div>
<div class="Annotations"><span class="insert2"><B>Reason:&nbsp;</B>The check 
prevents the returned object (for a nonlimited type) from outliving the 
object designated by one of its discriminants. The check is made on the 
values of the discriminants, which may come from the <SPAN Class="swiss"><A HREF="AA-6-5.html#S0187">return_subtype_indication</A></SPAN> 
(if constrained), or the <SPAN Class="swiss"><A HREF="AA-4-4.html#S0117">expression</A></SPAN>, 
but it is never necessary to check both.</span>&nbsp;</div>
<div class="paranum"><a name="p21.c">21.c/3</a></div>
<div class="Annotations"><span class="insert3"><B>Implementation Note: 
</B></span>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0234-1.TXT">AI05-0234-1</A></I>} 
<span class="insert3">The reason for saying &ldquo;any part of the specific 
type&rdquo; is to simplify implementation. In the case of class-wide 
result objects, this allows the testing of a simple flag in the tagged 
type descriptor that indicates whether the specific type has any parts 
with access discriminants. By basing the test on the type of the object 
rather than the object itself, we avoid concerns about whether subcomponents 
in variant parts and of arrays (which might be empty) are present.</span> 
</div>
<div class="paranum"><a name="p21.d">21.d/3</a></div>
<div class="Annotations"><span class="insert3"><B>Discussion:&nbsp;</B></span>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0234-1.TXT">AI05-0234-1</A></I>} 
<span class="insert3">For a function with a class-wide result type, the 
access values that need to be checked are determined by the tag of the 
return object. In order to implement this accessibility check in the 
case where the tag of the result is not known statically at the point 
of the return statement, an implementation may need to somehow associate 
with the tag of a specific tagged type an indication of whether the type 
has unconstrained access discriminants (explicit or inherited) or has 
any subcomponents with such discriminants. If an implementation is already 
maintaining a statically initialized descriptor of some kind for each 
specific tagged type, then an additional Boolean could be added to this 
descriptor.</span></div>
<div class="paranum"><a name="p21.e">21.e/3</a></div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0005-1.TXT">AI05-0005-1</A></I>} 
<span class="insert3"></span>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0234-1.TXT">AI05-0234-1</A></I>} 
<span class="insert3">Note that the flag should only be queried in the 
case where the result object might have access discriminants that might 
have subtypes with &quot;bad&quot; accessibility levels (as determined 
by the rules of <A HREF="AA-3-10-2.html">3.10.2</A> for determining the 
accessibility level of the type of an access discriminant in the <SPAN Class="swiss"><A HREF="AA-4-4.html#S0117">expression</A></SPAN> 
or <SPAN Class="swiss"><A HREF="AA-6-5.html#S0187">return_subtype_indication</A></SPAN> 
of a return statement).</span></div>
<div class="paranum"><a name="p21.f">21.f/3</a></div>
<div class="Annotations" style="margin-bottom: 0.4em"><span class="insert3">Thus, 
in a case like</span></div>
<div class="paranum"><a name="p21.g">21.g/3</a></div>
<div class="SmallExamples"><span class="insert3"><B>type</B>&nbsp;Global&nbsp;<B>is&nbsp;access</B>&nbsp;T'Class;<BR>
<B>function</B>&nbsp;F&nbsp;(Ptr&nbsp;:&nbsp;Global)&nbsp;<B>return</B>&nbsp;T'Class&nbsp;<B>is</B><BR>
<B>begin</B><BR>
&nbsp;&nbsp;&nbsp;<B>return</B>&nbsp;Ptr.<B>all</B>;<BR>
<B>end</B>&nbsp;F;</span></div>
<div class="paranum"><a name="p21.h">21.h/3</a></div>
<div class="Annotations" style="margin-bottom: 0.9em"><span class="insert3">there 
is no need for a run-time accessibility check. While an object of T'Class 
&quot;might have&quot; access discriminants, the accessibility of those 
potential discriminants cannot be bad. The setting of the bit doesn't 
matter and there is no need to query it.</span></div>
<div class="paranum"><a name="p21.i">21.i/3</a></div>
<div class="Annotations" style="margin-bottom: 0.4em"><span class="insert3">On 
the other hand, given</span>&nbsp;</div>
<div class="paranum"><a name="p21.j">21.j/3</a></div>
<div class="SmallExamples"><span class="insert3"><B>function</B>&nbsp;F&nbsp;<B>return</B>&nbsp;T'Class&nbsp;<B>is</B><BR>
&nbsp;&nbsp;&nbsp;Local&nbsp;:&nbsp;T'Class&nbsp;:=&nbsp;...&nbsp;;<BR>
<B>begin</B><BR>
&nbsp;&nbsp;&nbsp;<B>return</B>&nbsp;Local;<BR>
<B>end</B>&nbsp;F;</span></div>
<div class="paranum"><a name="p21.k">21.k/3</a></div>
<div class="Annotations" style="margin-bottom: 0.9em"><span class="insert3">In 
this case, a check would typically be required.</span></div>
<div class="paranum"><a name="p21.l">21.l/3</a></div>
<div class="Annotations" style="margin-bottom: 0.4em"><span class="insert3">The 
need for including subcomponents in this check is illustrated by the 
following example:</span>&nbsp;</div>
<div class="paranum"><a name="p21.m">21.m/3</a></div>
<div class="SmallExamples"><span class="insert3">X&nbsp;:&nbsp;<B>aliased</B>&nbsp;Integer;</span></div>
<div class="paranum"><a name="p21.n">21.n/3</a></div>
<div class="SmallExamples"><span class="insert3"><B>type</B>&nbsp;Component_Type&nbsp;(Discrim&nbsp;:&nbsp;<B>access</B>&nbsp;Integer&nbsp;:=&nbsp;X'Access)<BR>
&nbsp;&nbsp;&nbsp;<B>is&nbsp;limited&nbsp;null&nbsp;record</B>;</span></div>
<div class="paranum"><a name="p21.o">21.o/3</a></div>
<div class="SmallExamples"><span class="insert3"><B>type</B>&nbsp;Undiscriminated&nbsp;<B>is&nbsp;record</B><BR>
&nbsp;&nbsp;&nbsp;Fld&nbsp;:&nbsp;Component_Type;<BR>
<B>end&nbsp;record</B>;</span></div>
<div class="paranum"><a name="p21.p">21.p/3</a></div>
<div class="SmallExamples"><span class="insert3"><B>function</B>&nbsp;F&nbsp;<B>return</B>&nbsp;Undiscriminated&nbsp;<B>is</B><BR>
&nbsp;&nbsp;&nbsp;Local&nbsp;:&nbsp;<B>aliased</B>&nbsp;Integer;<BR>
<B>begin</B><BR>
&nbsp;&nbsp;&nbsp;<B>return</B>&nbsp;X&nbsp;:&nbsp;Undiscriminated&nbsp;:=&nbsp;(Fld&nbsp;=&gt;&nbsp;(Discrim&nbsp;=&gt;&nbsp;Local'Access))&nbsp;<B>do</B><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Foo;<BR>
&nbsp;&nbsp;&nbsp;<B>end&nbsp;return</B>;<BR>
&nbsp;&nbsp;&nbsp;--<SPAN Class="roman"><I>&nbsp;raises&nbsp;Program_Error&nbsp;after&nbsp;calling&nbsp;Foo.</I></SPAN><BR>
<B>end</B>&nbsp;F;</span></div>
<div class="paranum"><a name="p21.q">21.q/3</a></div>
<div class="Annotations"><span class="insert3"><B>Ramification:&nbsp;</B></span>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0234-1.TXT">AI05-0234-1</A></I>} 
<span class="insert3">In the case where the tag of the result is not 
known statically at the point of the return statement and the run-time 
accessibility check is needed, discriminant values and array bounds play 
no role in performing this check. That is, array components are assumed 
to have nonzero length and components declared within variant parts are 
assumed to be present. Thus, the check may be implemented simply by testing 
the aforementioned descriptor bit and conditionally raising Program_Error.</span> 
</div>
<div class="paranum"><a name="p22">22/3</a></div>
<div class="Normal">&nbsp;{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-10318.TXT">AI95-00318-02</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0058-1.TXT">AI05-0058-1</A></I>} 
<span class="insert2">For the execution of an <SPAN Class="swiss"><A HREF="AA-6-5.html#S0186">extended_return_statement</A></SPAN>, 
the <SPAN Class="swiss"><A HREF="AA-11-2.html#S0265">handled_sequence_of_statements</A></SPAN> 
is executed. Within this <SPAN Class="swiss"><A HREF="AA-11-2.html#S0265">handled_sequence_of_statements</A></SPAN>, 
the execution of a <SPAN Class="swiss"><A HREF="AA-6-5.html#S0183">simple_return_statement</A></SPAN> 
that applies to the <SPAN Class="swiss"><A HREF="AA-6-5.html#S0186">extended_return_statement</A></SPAN> 
causes a transfer of control that completes the <SPAN Class="swiss"><A HREF="AA-6-5.html#S0186">extended_return_statement</A></SPAN>. 
Upon completion of a return statement that applies to a callable construct</span><span class="insert3">&nbsp;by the normal completion of a <SPAN Class="swiss"><A HREF="AA-6-5.html#S0183">simple_return_statement</A></SPAN> 
or by reaching the <B>end return</B> of an <SPAN Class="swiss"><A HREF="AA-6-5.html#S0186">extended_return_statement</A></SPAN></span><span class="insert2"></span><span class="delete2">&nbsp;Finally</span>, 
a transfer of control is performed which completes the execution of the 
callable construct<span class="delete2">&nbsp;to which the <SPAN Class="swiss"><A HREF="AA-6-5.html#S0184">return_statement</A></SPAN> 
applies</span>, and returns to the caller.</div>
<div class="paranum"><a name="p22.a">22.a/3</a></div>
<div class="Annotations"><span class="insert3"><B>Ramification:&nbsp;</B></span>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0058-1.TXT">AI05-0058-1</A></I>} 
<span class="insert3">A transfer of control that completes an <SPAN Class="swiss"><A HREF="AA-6-5.html#S0186">extended_return_statement</A></SPAN> 
(such as an exit or goto) does not cause a return to the caller unless 
it is caused by <SPAN Class="swiss"><A HREF="AA-6-5.html#S0183">simple_return_statement</A></SPAN> 
(that is, triggers the second sentence of this paragraph). The return 
to the caller occurs for the <SPAN Class="swiss"><A HREF="AA-6-5.html#S0183">simple_return_statement</A></SPAN> 
that applies to an <SPAN Class="swiss"><A HREF="AA-6-5.html#S0186">extended_return_statement</A></SPAN> 
because the last sentence says &ldquo;the normal completion of a <SPAN Class="swiss"><A HREF="AA-6-5.html#S0183">simple_return_statement</A></SPAN>&rdquo;, 
which includes the one nested in the <SPAN Class="swiss"><A HREF="AA-6-5.html#S0186">extended_return_statement</A></SPAN>.</span> 
</div>
<div class="paranum"><a name="p23">23/2</a></div>
<div class="Normal">&nbsp;{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-10318.TXT">AI95-00318-02</A></I>} 
<span class="insert2">In the case of a function, the <SPAN Class="swiss"><A HREF="AA-6-4.html#S0179">function_call</A></SPAN> 
denotes a constant view of the return object.</span>&nbsp;</div>

<H4 Class="centered">Implementation Permissions</H4>
<div class="paranum"><a name="p24">24/3</a></div>
<div class="Normal" style="margin-bottom: 0.4em">&nbsp;{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00416.TXT">AI95-00416-01</A></I>} 
<span class="insert3"></span>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0050-1.TXT">AI05-0050-1</A></I>} 
<span class="insert3"></span><span class="insert2"></span><span class="insert3">For 
a function call used to initialize a composite</span><span class="insert2"></span><span class="insert2"><span class="delete3">&nbsp;If 
the result subtype of a function is unconstrained, and a call on the 
function is used to provide the initial value of an</span></span><span class="insert2">&nbsp;object with a constrained nominal subtype</span><span class="insert3">&nbsp;or used to initialize a return object that is built in place into such 
an object:</span><span class="insert2"></span><span class="insert2"><span class="delete3">, 
Constraint_Error may be raised at the point of the call (after abandoning 
the execution of the function body) if, while elaborating the <SPAN Class="swiss"><A HREF="AA-6-5.html#S0187">return_subtype_indication</A></SPAN> 
or evaluating the <SPAN Class="swiss"><A HREF="AA-4-4.html#S0117">expression</A></SPAN> 
of a return statement that applies to the function body, it is determined 
that the value of the result will violate the constraint of the subtype 
of this object.</span></span><span class="insert2"></span></div>
<div class="paranum"><a name="p24.1">24.1/3</a></div>
<div class="Bulleted">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0050-1.TXT">AI05-0050-1</A></I>} 
<span class="insert3">If the result subtype of the function is constrained, 
and conversion of an object of this subtype to the subtype of the object 
being initialized would raise Constraint_Error, then Constraint_Error 
may be raised before calling the function.</span></div>
<div class="paranum"><a name="p24.2">24.2/3</a></div>
<div class="Bulleted">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0050-1.TXT">AI05-0050-1</A></I>} 
<span class="insert3">If the result subtype of the function is unconstrained, 
and a return statement is executed such that the return object is known 
to be constrained, and conversion of the return object to the subtype 
of the object being initialized would raise Constraint_Error, then Constraint_Error 
may be raised at the point of the call (after abandoning the execution 
of the function body).</span>&nbsp;</div>
<div class="paranum"><a name="p24.a">24.a/3</a></div>
<div class="Annotations"><span class="insert2"><B>Reason:&nbsp;</B></span>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00416.TXT">AI95-00416-01</A></I>} 
<span class="insert2"></span>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0050-1.TXT">AI05-0050-1</A></I>} 
<span class="insert2">Without such a permission, it would be very difficult 
to implement &ldquo;</span><span class="insert3">&nbsp;built-in-place</span><span class="insert2"></span><span class="insert2"><span class="delete3">&nbsp;build-in-place</span></span><span class="insert2">&nbsp;&rdquo; 
semantics.&nbsp;</span><span class="insert3">The intention is that the exception 
is raised at the same point that it would have been raised without the 
permission; it should not change handlers if the implementation switches 
between return-by-copy and built-in-place. This means that the</span><span class="insert2"></span><span class="insert2"><span class="delete3">&nbsp;Such 
an</span></span><span class="insert2">&nbsp;exception is not handleable within 
the function, because in the return-by-copy case, the constraint check 
to verify that the result satisfies the constraints of the object being 
initialized happens after the function returns</span><span class="insert2"><span class="delete3">, 
and we want the semantics to change as little as possible when switching 
between return-by-copy and build-in-place</span></span><span class="insert2">. 
This implies further that upon detecting such a situation, the implementation 
may need to simulate a goto to a point outside any local exception handlers 
prior to raising the exception.</span>&nbsp;</div>
<div class="paranum"><a name="p24.b">24.b/3</a></div>
<div class="Annotations"><B>Ramification:&nbsp;</B>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00416.TXT">AI95-00416-01</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0050-1.TXT">AI05-0050-1</A></I>} 
<span class="insert3">These permissions do not apply in the case of an 
extended return object with mutable discriminants. That's necessary because 
in that case a return object can be created with the &ldquo;wrong&rdquo; 
discriminants and then changed to the &ldquo;right&rdquo; discriminants 
later (but before returning). We don't want this case raising an exception 
when the canonical semantics will not do so.</span><span class="delete3"></span><span class="insert2"><span class="delete3">&nbsp;This 
permission is allowed during the evaluation of the <SPAN Class="swiss"><A HREF="AA-4-4.html#S0117">expression</A></SPAN> 
of an <SPAN Class="swiss"><A HREF="AA-6-5.html#S0186">extended_return_statement</A></SPAN>, 
because the <SPAN Class="swiss"><A HREF="AA-6-5.html#S0187">return_subtype_indication</A></SPAN> 
may be unconstrained and the <SPAN Class="swiss"><A HREF="AA-4-4.html#S0117">expression</A></SPAN> 
then would provide the constraints.</span></span><span class="delete3"></span></div>
<div class="paranum"><a name="p24.c">24.c/3</a></div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0050-1.TXT">AI05-0050-1</A></I>} 
<span class="insert3">It's still possible to write a program that will 
raise an exception using this permission that would not in the canonical 
semantics. That could happen if a return statement with the &ldquo;wrong&rdquo; 
discriminants or bounds is abandoned (via an exception, or for an extended_return_statement, 
via an exit or goto statement), and then a return statement with the 
&ldquo;right&rdquo; discriminants or bounds is executed. The only solution 
for this problem is to not have the permission at all, but this is too 
unusual of a case to worry about the effects of the permission, especially 
given the implementation difficulties for built-in-place objects that 
this permission is intended to ease.</span></div>
<div class="paranum"><a name="p24.d">24.d/3</a></div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0050-1.TXT">AI05-0050-1</A></I>} 
<span class="insert3">Note that the mutable-discriminant case only happens 
when built-in-place initialization is optional. This means that any difficulties 
associated with implementing built-in-place initialization without these 
permissions can be sidestepped by not building in place.</span></div>

<H4 Class="centered">Examples</H4>
<div class="paranum"><a name="p25">25</a></div>
<div class="Normal" style="margin-bottom: 0.4em"><I>Examples of return 
statements:</I>&nbsp;</div>
<div class="paranum"><a name="p26">26/2</a></div>
<div class="Examples">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-10318.TXT">AI95-00318-02</A></I>} 
<B>return</B>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--<SPAN Class="roman"><I>&nbsp;in&nbsp;a&nbsp;procedure&nbsp;body,&nbsp;</I></SPAN><SPAN Class="swiss"><A HREF="AA-9-5-2.html#S0221">entry_body</A></SPAN><SPAN Class="roman"><I>,</I></SPAN><span class="insert2"><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;<SPAN Class="swiss"><A HREF="AA-9-5-2.html#S0219">accept_statement</A></SPAN><SPAN Class="roman"><I>,&nbsp;or&nbsp;</I></SPAN><SPAN Class="swiss"><A HREF="AA-6-5.html#S0186">extended_return_statement</A></SPAN></span><span class="delete2"><SPAN Class="roman"><I>&nbsp;or&nbsp;</I></SPAN><SPAN Class="swiss"><A HREF="AA-9-5-2.html#S0219">accept_statement</A></SPAN></span></div>
<div class="paranum"><a name="p27">27</a></div>
<div class="Examples"><B>return</B>&nbsp;Key_Value(Last_Index);&nbsp;&nbsp;&nbsp;--<SPAN Class="roman"><I>&nbsp;in&nbsp;a&nbsp;function&nbsp;body</I></SPAN></div>
<div class="paranum"><a name="p28">28/2</a></div>
<div class="Examples">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-10318.TXT">AI95-00318-02</A></I>} 
<span class="insert2"><B>return</B>&nbsp;Node&nbsp;:&nbsp;Cell&nbsp;<B>do</B>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--<SPAN Class="roman"><I>&nbsp;in&nbsp;a&nbsp;function&nbsp;body,&nbsp;see&nbsp;<A HREF="AA-3-10-1.html">3.10.1</A>&nbsp;for&nbsp;Cell</I></SPAN><BR>
&nbsp;&nbsp;&nbsp;Node.Value&nbsp;:=&nbsp;Result;<BR>
&nbsp;&nbsp;&nbsp;Node.Succ&nbsp;:=&nbsp;Next_Node;<BR>
<B>end</B>&nbsp;<B>return</B>;</span></div>

<H4 Class="centered">Incompatibilities With Ada 83</H4>
<div class="paranum"><a name="p28.a">28.a/2</a></div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-10318.TXT">AI95-00318-02</A></I>} 
<A NAME="I3941"></A>In Ada 95, if the result type of a function has a 
part that is a task, then an attempt to return a local variable will 
raise Program_Error. <span class="insert2">This is illegal in Ada 2005, 
see below.&nbsp;</span>In Ada 83, if a function returns a local variable containing 
a task, execution is erroneous according to AI83-00867. However, there 
are other situations where functions that return tasks (or that return 
a variant record only one of whose variants includes a task) are correct 
in Ada 83 but will raise Program_Error according to the new rules.</div>
<div class="paranum"><a name="p28.b">28.b</a></div>
<div class="Annotations">The rule change was made because there will 
be more types (protected types, limited controlled types) in Ada 95 for 
which it will be meaningless to return a local variable, and making all 
of these erroneous is unacceptable. The current rule was felt to be the 
simplest that kept upward incompatibilities to situations involving returning 
tasks, which are quite rare.&nbsp;</div>

<H4 Class="centered">Wording Changes from Ada 83</H4>
<div class="paranum"><a name="p28.c">28.c/3</a></div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0299-1.TXT">AI05-0299-1</A></I>} 
This <span class="insert3">subclause</span><span class="delete3">&nbsp;clause</span> 
has been moved here from chapter 5, since it has mainly to do with subprograms.</div>
<div class="paranum"><a name="p28.d">28.d</a></div>
<div class="Annotations">A function now creates an anonymous object. 
This is necessary so that controlled types will work.</div>
<div class="paranum"><a name="p28.e">28.e/2</a></div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-10318.TXT">AI95-00318-02</A></I>} 
We have clarified that a <span class="insert2">return statement</span><span class="delete2"><SPAN Class="swiss"><A HREF="AA-6-5.html#S0184">&nbsp;return_statement</A></SPAN></span> 
applies to a callable construct, not to a callable entity.</div>
<div class="paranum"><a name="p28.f">28.f/2</a></div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-10318.TXT">AI95-00318-02</A></I>} 
There is no need to mention generics in the rules about where a <span class="insert2">return 
statement</span><span class="delete2"><SPAN Class="swiss"><A HREF="AA-6-5.html#S0184">&nbsp;return_statement</A></SPAN></span> 
can appear and what it applies to; the phrase &ldquo;body of a subprogram 
or generic subprogram&rdquo; is syntactic, and refers exactly to &ldquo;<SPAN Class="swiss"><A HREF="AA-6-3.html#S0177">subprogram_body</A></SPAN>&rdquo;. 
</div>

<H4 Class="centered">Inconsistencies With Ada 95</H4>
<div class="paranum"><a name="p28.f.1">28.f.1/3</a></div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00416.TXT">AI95-0416-1</A></I>} 
<span class="insert2"></span>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0005-1.TXT">AI05-0005-1</A></I>} 
<span class="insert2"></span>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0050-1.TXT">AI05-0050-1</A></I>} 
<span class="insert2"><A NAME="I3942"></A>Added an Implementation Permission 
allowing early raising of Constraint_Error if the result cannot fit in 
the ultimate object. This gives implementations more flexibility to do 
built-in-place returns, and is essential for limited types (which cannot 
be built in a temporary). However, it allows raising&nbsp;</span><span class="insert2"><span class="delete3">an 
</span></span><span class="insert2">Constraint_Error in some cases where 
it would not be raised if the permission was not used.&nbsp;</span><span class="insert3">See 
Inconsistencies With Ada 2005 for additional changes.&nbsp;</span><span class="insert2">This 
case is potentially inconsistent with Ada 95, but a compiler does not 
have to take advantage of these permissions for any Ada 95 code, so there 
should be little practical impact.</span>&nbsp;</div>

<H4 Class="centered">Incompatibilities With Ada 95</H4>
<div class="paranum"><a name="p28.g">28.g/2</a></div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-10318.TXT">AI95-00318-02</A></I>} 
<span class="insert2"><A NAME="I3943"></A> The entire business about 
return-by-reference types has been dropped. Instead, the <SPAN Class="swiss"><A HREF="AA-4-4.html#S0117">expression</A></SPAN> 
of a return statement of a limited type can only be an <SPAN Class="swiss"><A HREF="AA-4-3.html#S0106">aggregate</A></SPAN> 
or <SPAN Class="swiss"><A HREF="AA-6-4.html#S0179">function_call</A></SPAN> 
(see <A HREF="AA-7-5.html">7.5</A>). This means that returning a global 
object or <SPAN Class="swiss"><A HREF="AA-4-6.html#S0141">type_conversion</A></SPAN>, 
legal in Ada 95, is now illegal. Such functions can be converted to use 
anonymous access return types by adding <B>access</B> in the function 
definition and return statement, adding .<B>all</B> in uses, and adding 
<B>aliased</B> in the object declarations. This has the advantage of 
making the reference return semantics much clearer to the casual reader.</span></div>
<div class="paranum"><a name="p28.h">28.h/2</a></div>
<div class="Annotations"><span class="insert2">We changed these rules 
so that functions, combined with the new rules for limited types (<A HREF="AA-7-5.html">7.5</A>), 
can be used as build-in-place constructors for limited types. This reduces 
the differences between limited and nonlimited types, which will make 
limited types useful in more circumstances.</span>&nbsp;</div>

<H4 Class="centered">Extensions to Ada 95</H4>
<div class="paranum"><a name="p28.i">28.i/2</a></div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-10318.TXT">AI95-00318-02</A></I>} 
<span class="insert2"><A NAME="I3944"></A>The <SPAN Class="swiss"><A HREF="AA-6-5.html#S0186">extended_return_statement</A></SPAN> 
is new. This provides a name for the object being returned, which reduces 
the copying needed to return complex objects (including no copying at 
all for limited objects). It also allows component-by-component construction 
of the return object.</span>&nbsp;</div>

<H4 Class="centered">Wording Changes from Ada 95</H4>
<div class="paranum"><a name="p28.j">28.j/2</a></div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-10318.TXT">AI95-00318-02</A></I>} 
<span class="insert2">The wording was updated to support anonymous access 
return subtypes.</span></div>
<div class="paranum"><a name="p28.k">28.k/2</a></div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-10318.TXT">AI95-00318-02</A></I>} 
<span class="insert2">The term &ldquo;return expression&rdquo; was dropped 
because reviewers found it confusing when applied to the default <SPAN Class="swiss"><A HREF="AA-4-4.html#S0117">expression</A></SPAN> 
of an <SPAN Class="swiss"><A HREF="AA-6-5.html#S0186">extended_return_statement</A></SPAN>.</span></div>
<div class="paranum"><a name="p28.l">28.l/2</a></div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00344.TXT">AI95-00344-01</A></I>} 
<span class="insert2"></span>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00416.TXT">AI95-00416-01</A></I>} 
<span class="insert2">Added accessibility checks to class-wide return 
statements. These checks could not fail in Ada 95 (as all of the types 
had to be declared at the same level, so the tagged type would necessarily 
have been at the same level as the type of the object).</span></div>
<div class="paranum"><a name="p28.m">28.m/2</a></div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00402.TXT">AI95-00402-01</A></I>} 
<span class="insert2"></span>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00416.TXT">AI95-00416-01</A></I>} 
<span class="insert2">Added accessibility checks to return statements 
for types with access discriminants. Since such types have to be limited 
in Ada 95, the <SPAN Class="swiss"><A HREF="AA-4-4.html#S0117">expression</A></SPAN> 
of a return statement would have been illegal in order for this check 
to fail.</span>&nbsp;</div>

<H4 Class="centered">Inconsistencies With Ada 2005</H4>
<div class="paranum"><a name="p28.n">28.n/3</a></div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0050-1.TXT">AI05-0050-1</A></I>} 
<span class="insert3"><A NAME="I3945"></A><B>Correction:</B> The Implementation 
Permission allowing early raising of Constraint_Error was modified to 
remove the most common of these cases from the permission (returning 
an object with mutable discriminants, where the return object is created 
with one set of discriminants and then changed to another). (The permission 
was also widened to allow the early check for constrained functions when 
that constraint is wrong.) However, there still is an unlikely case where 
the permission would allow an exception to be raised when none would 
be raised by the canonical semantics (when a return statement is abandoned). 
These changes can only remove the raising of an exception (or change 
the place where it is raised) compared to Ada 2005, so programs that 
depend on the previous behavior should be very rare.</span></div>
<div class="paranum"><a name="p28.o">28.o/3</a></div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0051-1.TXT">AI05-0051-1</A></I>} 
<span class="insert3"></span>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0234-1.TXT">AI05-0234-1</A></I>} 
<span class="insert3"><B>Correction:</B> Accessibility checks for access 
discriminants now depend on the master of the call rather than the point 
of declaration of the function. This will result in cases that used to 
raise Program_Error now running without raising any exception. This is 
technically inconsistent with Ada 2005 (as defined by Amendment 1), but 
it is unlikely that any real code depends on the raising of this exception.</span></div>
<div class="paranum"><a name="p28.p">28.p/3</a></div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0073-1.TXT">AI05-0073-1</A></I>} 
<span class="insert3"><B>Correction:</B> Added a tag check for functions 
returning anonymous access-to-tagged types, so that dispatching of tag-indeterminate 
function works as expected. This is technically inconsistent with Ada 
2005 (as defined by Amendment 1), but as the feature in question was 
newly added to Ada 2005, there should be little code that depends on 
the behavior that now raises an exception.</span>&nbsp;</div>

<H4 Class="centered">Incompatibilities With Ada 2005</H4>
<div class="paranum"><a name="p28.q">28.q/3</a></div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0053-1.TXT">AI05-0053-1</A></I>} 
<span class="insert3"></span>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0277-1.TXT">AI05-0277-1</A></I>} 
<span class="insert3"><A NAME="I3946"></A><B>Correction:</B> The <B>aliased</B> 
keyword can now only appear on extended return objects with an immutably 
limited type. Other types would provide a way to get an aliased view 
of an object that is not necessarily aliased, which would be very bad. 
This is incompatible, but since the feature was added in Ada 2005, the 
keyword had no defined meaning in Ada 2005 (a significant oversight), 
and most sensible uses involve immutably limited types, it is unlikely 
that it appears meaningfully in existing programs.</span></div>
<div class="paranum"><a name="p28.r">28.r/3</a></div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0103-1.TXT">AI05-0103-1</A></I>} 
<span class="insert3"><B>Correction:</B> Added wording to require static 
matching for unconstrained access types in extended return statements. 
This disallows adding or omitting null exclusions, and adding access 
constraints, in the declaration of the return object. While this is incompatible, 
the incompatible cases in question are either useless (access constraints 
&ndash; the constraint can be given on an <SPAN Class="swiss"><A HREF="AA-4-8.html#S0143">allocator</A></SPAN> 
if necessary, and still must be given there even if given on the return 
object) or wrong (null exclusions &ndash; null could be returned from 
a function declared to be null excluding), so we expect them to be extremely 
rare in practice.</span>&nbsp;</div>

<H4 Class="centered">Extensions to Ada 2005</H4>
<div class="paranum"><a name="p28.s">28.s/3</a></div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0015-1.TXT">AI05-0015-1</A></I>} 
<span class="insert3"></span>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0144-2.TXT">AI05-0144-2</A></I>} 
<span class="insert3"><A NAME="I3947"></A>The return object of an <SPAN Class="swiss"><A HREF="AA-6-5.html#S0186">extended_return_statement</A></SPAN> 
can be declared constant; this works similarly to a constant object declaration.</span></div>
<div class="paranum"><a name="p28.t">28.t/3</a></div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0032-1.TXT">AI05-0032-1</A></I>} 
<span class="insert3">Added wording to allow the <SPAN Class="swiss"><A HREF="AA-6-5.html#S0187">return_subtype_indication</A></SPAN> 
to have a specific type if the return subtype of the function is class-wide. 
Specifying the (specific) type of the return object is awkward without 
this change, and this is consistent with the way <SPAN Class="swiss"><A HREF="AA-4-8.html#S0143">allocator</A></SPAN>s 
work.</span>&nbsp;</div>

<H4 Class="centered">Wording Changes from Ada 2005</H4>
<div class="paranum"><a name="p28.u">28.u/3</a></div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0024-1.TXT">AI05-0024-1</A></I>} 
<span class="insert3"><B>Correction:</B> Corrected the master check for 
tags since the masters may be for different tasks and thus incomparable.</span></div>
<div class="paranum"><a name="p28.v">28.v/3</a></div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0058-1.TXT">AI05-0058-1</A></I>} 
<span class="insert3"><B>Correction:</B> Corrected the wording defining 
returns for <SPAN Class="swiss"><A HREF="AA-6-5.html#S0186">extended_return_statement</A></SPAN>s, 
since leaving by an exit or goto is considered &ldquo;normal&rdquo; completion 
of the statement.</span></div>
<div class="paranum"><a name="p28.w">28.w/3</a></div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0205-1.TXT">AI05-0205-1</A></I>} 
<span class="insert3"></span>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0277-1.TXT">AI05-0277-1</A></I>} 
<span class="insert3"><B>Correction:</B> Added the <SPAN Class="swiss"><A HREF="AA-6-5.html#S0185">extended_return_object_declaration</A></SPAN> 
to make other rules easier to write and eliminate the problem described 
in AI05-0205-1.</span>&nbsp;</div>

</div>
<div class="navig"><A HREF="AA-TOC.html">Contents</A>&nbsp;
&nbsp;<A HREF="AA-0-4.html">Index</A>&nbsp;
&nbsp;<A HREF="AA-STDS.html">References</A>&nbsp;
&nbsp;<A HREF="AA-SRCH.html">Search</A>&nbsp;
&nbsp;<A HREF="AA-6-4-1.html">Previous</A>&nbsp;
&nbsp;<A HREF="AA-6-5-1.html">Next</A>&nbsp;
</div>
<DIV Style="margin-top:0.0em">
<SPAN Style="vertical-align: middle; font-size:120%">Ada 2005 and 2012 Editions sponsored in part by <SPAN Style="font-size: 125%"><A HREF="http://www.ada-europe.org/"><B>Ada-Europe</B></A></SPAN></SPAN></DIV>
</BODY>
</HTML>
