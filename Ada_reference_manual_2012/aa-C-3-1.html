<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<HTML>
<HEAD>
    <TITLE>Protected Procedure Handlers</TITLE>
    <META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
    <META NAME="Author" CONTENT="JTC1/SC22/WG9/ARG, by Randall Brukardt, ARG Editor">
    <META NAME="GENERATOR" CONTENT="Arm_Form.Exe, Ada Reference Manual generator">
    <link rel="stylesheet" href="../styles.css">
	<link rel="icon" href="../logo.svg">
</HEAD>
<BODY TEXT="#000000" BGCOLOR="#FFFFF0" LINK="#000080" VLINK="#330033" ALINK="#0000FF">
<DIV><B><SPAN Style="font-size:200%; color: rgb(0,51,153)">Annotated</SPAN><SPAN Style="font-size:200%; color: rgb(0,0,102)">&nbsp;Ada Reference Manual</SPAN></B> &mdash; <A HREF="AA-TTL.html"><B>Legal Information</B></A></DIV>
<div style="margin-top: 0.6em; margin-bottom: 0.0em"><A HREF="AA-TOC.html"><IMG SRC="cont.gif" ALT="Contents" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-0-4.html"><IMG SRC="index.gif" ALT="Index" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-STDS.html"><IMG SRC="lib.gif" ALT="References" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-SRCH.html"><IMG SRC="find.gif" ALT="Search" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-C-3.html"><IMG SRC="prev.gif" ALT="Previous" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-C-3-2.html"><IMG SRC="next.gif" ALT="Next" BORDER=0></A>&nbsp;
</div>
<div class="main">
<H1>C.3.1 Protected Procedure Handlers</H1>
<div class="Normal"><span class="insert3"><SPAN STYLE="font-size: 80%"><I>Paragraphs 
1 through 6 were moved to <A HREF="AA-J.html">Annex J</A>, &ldquo;<A HREF="AA-J.html">Obsolescent 
Features</A>&rdquo;.</I></SPAN></span>&nbsp;</div>

<H4 Class="centered">Syntax</H4>
<div class="paranum"><a name="p1">1/3</a></div>
<div class="Indented1" style="margin-bottom: 0.4em">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0229-1.TXT">AI05-0229-1</A></I>} 
<span class="delete3">The form of a <SPAN Class="swiss"><A HREF="AA-2-8.html#S0019">pragma</A></SPAN> 
Interrupt_Handler is as follows:</span>&nbsp;</div>
<div class="paranum"><a name="p2">2/3</a></div>
<div class="Indented1">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0229-1.TXT">AI05-0229-1</A></I>} 
&nbsp;&nbsp;<span class="delete3"><B>pragma</B> <A NAME="I8521"></A><A NAME="I8522"></A>Interrupt_Handler(<I>handler_</I><A NAME="I8523"></A><SPAN Class="swiss"><A HREF="AA-4-1.html#S0091">name</A></SPAN>);</span></div>
<div class="paranum"><a name="p3">3/3</a></div>
<div class="Indented1" style="margin-bottom: 0.4em">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0229-1.TXT">AI05-0229-1</A></I>} 
<span class="delete3">The form of a <SPAN Class="swiss"><A HREF="AA-2-8.html#S0019">pragma</A></SPAN> 
Attach_Handler is as follows:</span>&nbsp;</div>
<div class="paranum"><a name="p4">4/3</a></div>
<div class="Indented1">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0229-1.TXT">AI05-0229-1</A></I>} 
&nbsp;&nbsp;<span class="delete3"><B>pragma</B> <A NAME="I8524"></A><A NAME="I8525"></A>Attach_Handler(<I>handler_</I><A NAME="I8526"></A><SPAN Class="swiss"><A HREF="AA-4-1.html#S0091">name</A></SPAN>, 
<A NAME="I8527"></A><SPAN Class="swiss"><A HREF="AA-4-4.html#S0117">expression</A></SPAN>);</span> 
</div>

<H4 Class="centered">Name Resolution Rules</H4>
<div class="paranum"><a name="p5">5/3</a></div>
<div class="Normal">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0229-1.TXT">AI05-0229-1</A></I>} 
<span class="delete3">For the Interrupt_Handler and Attach_Handler pragmas, 
the <I>handler_</I><SPAN Class="swiss"><A HREF="AA-4-1.html#S0091">name</A></SPAN> 
shall resolve to denote a protected procedure with a parameterless profile.</span></div>
<div class="paranum"><a name="p6">6/3</a></div>
<div class="Normal">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0229-1.TXT">AI05-0229-1</A></I>} 
<span class="delete3">For the Attach_Handler pragma, the expected type 
for the <SPAN Class="swiss"><A HREF="AA-4-4.html#S0117">expression</A></SPAN> 
is Interrupts.Interrupt_Id (see <A HREF="AA-C-3-2.html">C.3.2</A>).</span> 
</div>

<H4 Class="centered">Static Semantics</H4>
<div class="paranum"><a name="p6.1">6.1/3</a></div>
<div class="Normal" style="margin-bottom: 0.4em">&nbsp;&nbsp;{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0229-1.TXT">AI05-0229-1</A></I>} 
<span class="insert3">For a parameterless protected procedure, the following 
language-defined representation aspects may be specified:</span>&nbsp;</div>
<div class="paranum"><a name="p6.2">6.2/3</a></div>
<div class="WideHanging-Term">&nbsp;&nbsp;<span class="insert3">Interrupt_Handler</span></div><div class="WideHanging-Body"><br clear="left">
<span class="insert3">&nbsp;The type of aspect Interrupt_Handler is Boolean. 
If directly specified, the aspect_definition shall be a static expression. 
[This aspect is never inherited;] if not directly specified, the aspect 
is False.<A NAME="I8528"></A><A NAME="I8529"></A></span></div>
<div class="paranum"><a name="p6.a">6.a/3</a></div>
<div class="Annotations"><span class="insert3"><B>Aspect Description 
for&nbsp;</B></span><span class="insert3"><B>Interrupt_Handler:&nbsp;</B></span><span class="insert3">Protected 
procedure may be attached to interrupts.</span></div>
<div class="paranum"><a name="p6.3">6.3/3</a></div>
<div class="WideHanging-Term">&nbsp;&nbsp;<span class="insert3">Attach_Handler</span></div><div class="WideHanging-Body"><br clear="left">
<span class="insert3">&nbsp;The aspect Attach_Handler is an <SPAN Class="swiss"><A HREF="AA-4-4.html#S0117">expression</A></SPAN>, 
which shall be of type Interrupts.Interrupt_Id. [This aspect is never 
inherited.]<A NAME="I8530"></A><A NAME="I8531"></A></span></div>
<div class="paranum"><a name="p6.b">6.b/3</a></div>
<div class="Annotations"><span class="insert3"><B>Aspect Description 
for&nbsp;</B></span><span class="insert3"><B>Attach_Handler:&nbsp;</B></span><span class="insert3">Protected 
procedure is attached to an interrupt.</span></div>

<H4 Class="centered">Legality Rules</H4>
<div class="paranum"><a name="p7">7/3</a></div>
<div class="Normal">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00434.TXT">AI95-00434-01</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0033-1.TXT">AI05-0033-1</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0229-1.TXT">AI05-0229-1</A></I>} 
<span class="insert3">If either the</span><span class="delete3">&nbsp;The</span> 
Attach_Handler <span class="insert3">or Interrupt_Handler aspect are 
specified for a protected procedure, the</span><span class="delete3">&nbsp;pragma 
is only allowed immediately within the <SPAN Class="swiss"><A HREF="AA-9-4.html#S0212">protected_definition</A></SPAN> 
where the corresponding subprogram is declared. The</span> corresponding 
<SPAN Class="swiss"><A HREF="AA-9-4.html#S0210">protected_type_declaration</A></SPAN> 
or <SPAN Class="swiss"><A HREF="AA-9-4.html#S0211">single_protected_declaration</A></SPAN> 
shall be a library<span class="insert2">-</span> level declaration<span class="insert3">&nbsp;and shall not be declared within a generic body. <A NAME="I8532"></A>In 
addition to the places where Legality Rules normally apply (see <A HREF="AA-12-3.html">12.3</A>), 
this rule also applies in the private part of an instance of a generic 
unit</span>.</div>
<div class="paranum"><a name="p7.a">7.a</a></div>
<div class="Annotations"><B>Discussion:&nbsp;</B>In the case of a <SPAN Class="swiss"><A HREF="AA-9-4.html#S0210">protected_type_declaration</A></SPAN>, 
an <SPAN Class="swiss"><A HREF="AA-3-3-1.html#S0032">object_declaration</A></SPAN> 
of an object of that type need not be at library level.</div>
<div class="paranum"><a name="p7.b">7.b/3</a></div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0033-1.TXT">AI05-0033-1</A></I>} 
<span class="insert3"></span>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0229-1.TXT">AI05-0229-1</A></I>} 
<span class="insert3">We cannot allow these aspects in protected declarations 
in a generic body, because legality rules are not checked for instance 
bodies, and these should not be allowed if the instance is not at the 
library level. The protected types can be declared in the private part 
if this is desired. Note that while the 'Access to use the handler would 
provide the check in the case of Interrupt_Handler, there is no other 
check for Attach_Handler. Since these aspects are so similar, we want 
the rules to be the same.</span>&nbsp;</div>
<div class="paranum"><a name="p8">8/3</a></div>
<div class="Normal"><SPAN STYLE="font-size: 80%"><I>This paragraph was 
deleted.</I></SPAN><span class="delete3"></span>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00253.TXT">AI95-00253-01</A></I>} 
<span class="delete3"></span>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00303.TXT">AI95-00303-01</A></I>} 
<span class="delete3"></span>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0033-1.TXT">AI05-0033-1</A></I>} 
<span class="delete3">The Interrupt_Handler pragma is only allowed immediately 
within&nbsp;</span><span class="insert2"><span class="delete3">the</span></span><span class="delete3"></span><span class="delete2">&nbsp;a</span><span class="delete3">&nbsp;<SPAN Class="swiss"><A HREF="AA-9-4.html#S0212">protected_definition</A></SPAN></span><span class="insert2"><span class="delete3">&nbsp;where the corresponding subprogram is declared</span></span><span class="delete3">. 
The corresponding <SPAN Class="swiss"><A HREF="AA-9-4.html#S0210">protected_type_declaration</A></SPAN> 
</span><span class="insert2"><span class="delete3">or <SPAN Class="swiss"><A HREF="AA-9-4.html#S0211">single_protected_declaration</A></SPAN> 
</span></span><span class="delete3">shall be a library</span><span class="insert2"><span class="delete3">-</span></span><span class="delete3">&nbsp;level 
declaration.</span><span class="delete2">&nbsp;In addition, any <SPAN Class="swiss"><A HREF="AA-3-3-1.html#S0032">object_declaration</A></SPAN> 
of such a type shall be a library level declaration.</span><span class="delete3"></span> 
</div>

<H4 Class="centered">Dynamic Semantics</H4>
<div class="paranum"><a name="p9">9/3</a></div>
<div class="Normal">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0229-1.TXT">AI05-0229-1</A></I>} 
If the <span class="delete3">pragma&nbsp;</span>Interrupt_Handler <span class="insert3">aspect 
of a protected procedure is True</span><span class="delete3">&nbsp;appears 
in a <SPAN Class="swiss"><A HREF="AA-9-4.html#S0212">protected_definition</A></SPAN></span>, 
then the <span class="delete3">corresponding&nbsp;</span>procedure <span class="insert3">may</span><span class="delete3">&nbsp;can</span> 
be attached dynamically, as a handler, to interrupts (see <A HREF="AA-C-3-2.html">C.3.2</A>). 
[Such procedures are allowed to be attached to multiple interrupts.]</div>
<div class="paranum"><a name="p10">10/3</a></div>
<div class="Normal">&nbsp;{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0229-1.TXT">AI05-0229-1</A></I>} 
<A NAME="I8533"></A><A NAME="I8534"></A>The <SPAN Class="swiss"><A HREF="AA-4-4.html#S0117">expression</A></SPAN> 
<span class="insert3">specified for</span><span class="delete3">&nbsp;in</span> 
the Attach_Handler <span class="insert3">aspect of a protected procedure 
<I>P</I> is evaluated as part of the creation of the protected object 
that contains <I>P</I>. The value of the <SPAN Class="swiss"><A HREF="AA-4-4.html#S0117">expression</A></SPAN> 
identifies</span><span class="delete3">&nbsp;pragma [as evaluated at object 
creation time] specifies</span> an interrupt. As part of the initialization 
of that object, <span class="insert3"><I>P</I> (</span><span class="delete3">&nbsp;if 
the Attach_Handler pragma is specified,&nbsp;</span>the <I>handler</I> procedure<span class="insert3">)</span> 
is attached to the <span class="insert3">identified</span><span class="delete3">&nbsp;specified</span> 
interrupt. <A NAME="I8535"></A><A NAME="I8536"></A>A check is made that 
the corresponding interrupt is not reserved. <A NAME="I8537"></A>Program_Error 
is raised if the check fails, and the existing treatment for the interrupt 
is not affected.</div>
<div class="paranum"><a name="p11">11/3</a></div>
<div class="Normal">&nbsp;{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00434.TXT">AI95-00434-01</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0229-1.TXT">AI05-0229-1</A></I>} 
<A NAME="I8538"></A><A NAME="I8539"></A><A NAME="I8540"></A>If the Ceiling_Locking 
policy (see <A HREF="AA-D-3.html">D.3</A>) is in effect<span class="insert2">,</span> 
then upon the initialization of a protected object <span class="insert3">that 
contains a protected procedure&nbsp;</span><span class="insert2">for which</span><span class="delete2">&nbsp;that</span> 
either <span class="insert3">the</span><span class="delete3">&nbsp;an</span> 
Attach_Handler<span class="insert3">&nbsp;aspect is specified</span> or <span class="insert3">the 
</span> Interrupt_Handler <span class="insert3">aspect is True</span><span class="delete3">&nbsp;pragma 
applies to one of its procedures</span>, a check is made that the <span class="insert3">initial 
</span>ceiling priority <span class="insert3">of the object</span><span class="delete3">&nbsp;defined 
in the <SPAN Class="swiss"><A HREF="AA-9-4.html#S0212">protected_definition</A></SPAN></span> 
is in the range of System.Interrupt_Priority. <A NAME="I8541"></A>If 
the check fails, Program_Error is raised.</div>
<div class="paranum"><a name="p12">12/3</a></div>
<div class="Normal">&nbsp;{<I><A HREF="defect1.html#8652/0068">8652/0068</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00121.TXT">AI95-00121-01</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0229-1.TXT">AI05-0229-1</A></I>} 
<A NAME="I8542"></A>When a protected object is finalized, for any of 
its procedures that are attached to interrupts, the handler is detached. 
If the handler was attached by a procedure in the Interrupts package 
or if no user handler was previously attached to the interrupt, the default 
treatment is restored. <span class="insert1">If&nbsp;</span><span class="insert3">the</span><span class="insert1"></span><span class="insert1"><span class="delete3">&nbsp;an</span></span><span class="insert1">&nbsp;Attach_Handler&nbsp;</span><span class="insert3">aspect</span><span class="insert1"></span><span class="insert1"><span class="delete3">&nbsp;pragma</span></span><span class="insert1">&nbsp;was&nbsp;</span><span class="insert3">specified</span><span class="insert1"></span><span class="insert1"><span class="delete3">&nbsp;used</span></span><span class="insert1">&nbsp;and the most recently attached handler for the same interrupt is the 
same as the one that was attached at the time the protected object was 
initialized</span><span class="delete1">&nbsp;Otherwise, [that is, if an Attach_Handler 
pragma was specified]</span>, the previous handler is restored.&nbsp;</div>
<div class="paranum"><a name="p12.a">12.a/3</a></div>
<div class="Annotations"><B>Discussion:&nbsp;</B>{<I><A HREF="defect1.html#8652/0068">8652/0068</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00121.TXT">AI95-00121-01</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00303.TXT">AI95-00303-01</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0229-1.TXT">AI05-0229-1</A></I>} 
<span class="insert1">If all protected objects for interrupt handlers 
are declared at the library</span><span class="insert2">&nbsp;</span><span class="insert1"></span><span class="insert1"><span class="delete2">-</span></span><span class="insert1">&nbsp;level</span><span class="delete1">&nbsp;Since 
only library-level protected procedures can be attached as handlers using 
the Interrupts package</span>, the finalization discussed above occurs 
only as part of the finalization of all library-level packages in a partition. 
<span class="insert1">However, objects of a protected type containing 
</span><span class="insert3">procedures with&nbsp;</span><span class="insert1">an 
Attach_Handler&nbsp;</span><span class="insert3">aspect specified</span><span class="insert1"></span><span class="insert1"><span class="delete3">&nbsp;pragma</span></span><span class="insert1">&nbsp;need not be at the library level. Thus, an implementation needs to be 
able to restore handlers during the execution of the program.</span><span class="insert2">&nbsp;(An object with an Interrupt_Handler&nbsp;</span><span class="insert3">aspect</span><span class="insert2"></span><span class="insert2"><span class="delete3">&nbsp;pragma</span></span><span class="insert2">&nbsp;also need not be at the library level, but such a handler cannot be attached 
to an interrupt using the Interrupts package.)</span><span class="insert1"></span> 
</div>
<div class="paranum"><a name="p13">13</a></div>
<div class="Normal">When a handler is attached to an interrupt, the interrupt 
is blocked [(subject to the Implementation Permission in <A HREF="AA-C-3.html">C.3</A>)] 
during the execution of every protected action on the protected object 
containing the handler.</div>

<H4 Class="centered">Erroneous Execution</H4>
<div class="paranum"><a name="p14">14</a></div>
<div class="Normal"><A NAME="I8543"></A>If the Ceiling_Locking policy 
(see <A HREF="AA-D-3.html">D.3</A>) is in effect and an interrupt is 
delivered to a handler, and the interrupt hardware priority is higher 
than the ceiling priority of the corresponding protected object, the 
execution of the program is erroneous.</div>
<div class="paranum"><a name="p14.1">14.1/3</a></div>
<div class="Normal">&nbsp;&nbsp;&nbsp;{<I><A HREF="defect1.html#8652/0068">8652/0068</A></I>} 
<span class="insert1"></span>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00121.TXT">AI95-00121-01</A></I>} 
<span class="insert1"></span>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0229-1.TXT">AI05-0229-1</A></I>} 
<span class="insert1"><A NAME="I8544"></A>If the handlers for a given 
interrupt attached via&nbsp;</span><span class="insert3">aspect</span><span class="insert1"></span><span class="insert1"><span class="delete3">&nbsp;pragma</span></span><span class="insert1">&nbsp;Attach_Handler are not attached and detached in a stack-like (LIFO) order, 
program execution is erroneous. In particular, when a protected object 
is finalized, the execution is erroneous if any of the procedures of 
the protected object are attached to interrupts via&nbsp;</span><span class="insert3">aspect</span><span class="insert1"></span><span class="insert1"><span class="delete3">&nbsp;pragma</span></span><span class="insert1">&nbsp;Attach_Handler and the most recently attached handler for the same interrupt 
is not the same as the one that was attached at the time the protected 
object was initialized.</span>&nbsp;</div>
<div class="paranum"><a name="p14.a">14.a/3</a></div>
<div class="Annotations"><span class="insert1"><B>Discussion:&nbsp;</B></span>{<I><A HREF="defect1.html#8652/0068">8652/0068</A></I>} 
<span class="insert1"></span>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00121.TXT">AI95-00121-01</A></I>} 
<span class="insert1"></span>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0229-1.TXT">AI05-0229-1</A></I>} 
<span class="insert1">This simplifies implementation of the Attach_Handler 
</span><span class="insert3">aspect</span><span class="insert1"></span><span class="insert1"><span class="delete3">&nbsp;pragma</span></span><span class="insert1">&nbsp;by not requiring a check that the current handler is the same as the 
one attached by the initialization of a protected object.</span>&nbsp;</div>

<H4 Class="centered">Metrics</H4>
<div class="paranum"><a name="p15">15</a></div>
<div class="Normal" style="margin-bottom: 0.4em">The following metric 
shall be documented by the implementation:&nbsp;</div>
<div class="paranum"><a name="p16">16/2</a></div>
<div class="Bulleted">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00434.TXT">AI95-00434-01</A></I>} 
The worst<span class="insert2">-</span><span class="delete2">&nbsp;</span>case 
overhead for an interrupt handler that is a parameterless protected procedure, 
in clock cycles. This is the execution time not directly attributable 
to the handler procedure or the interrupted execution. It is estimated 
as C &ndash; (A+B), where A is how long it takes to complete a given 
sequence of instructions without any interrupt, B is how long it takes 
to complete a normal call to a given protected procedure, and C is how 
long it takes to complete the same sequence of instructions when it is 
interrupted by one execution of the same procedure called via an interrupt. 
</div>
<div class="paranum"><a name="p16.a">16.a</a></div>
<div class="Annotations"><B>Implementation Note:&nbsp;</B>The instruction 
sequence and interrupt handler used to measure interrupt handling overhead 
should be chosen so as to maximize the execution time cost due to cache 
misses. For example, if the processor has cache memory and the activity 
of an interrupt handler could invalidate the contents of cache memory, 
the handler should be written such that it invalidates all of the cache 
memory.&nbsp;</div>
<div class="paranum"><a name="p16.b">16.b/2</a></div>
<div class="Annotations"><span class="insert2"><B>Documentation Requirement: 
</B></span><span class="insert2">The metrics for interrupt handlers.</span></div>

<H4 Class="centered">Implementation Permissions</H4>
<div class="paranum"><a name="p17">17/3</a></div>
<div class="Normal">&nbsp;{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0229-1.TXT">AI05-0229-1</A></I>} 
When the <span class="insert3">aspects</span><span class="delete3">&nbsp;pragmas</span> 
Attach_Handler or Interrupt_Handler <span class="insert3">are specified 
for</span><span class="delete3">&nbsp;apply to</span> a protected procedure, 
the implementation is allowed to impose implementation-defined restrictions 
on the corresponding <SPAN Class="swiss"><A HREF="AA-9-4.html#S0210">protected_type_declaration</A></SPAN> 
and <SPAN Class="swiss"><A HREF="AA-9-4.html#S0215">protected_body</A></SPAN>. 
</div>
<div class="paranum"><a name="p17.a">17.a</a></div>
<div class="Annotations"><B>Ramification:&nbsp;</B>The restrictions may be 
on the constructs that are allowed within them, and on ordinary calls 
(i.e. not via interrupts) on protected operations in these protected 
objects.&nbsp;</div>
<div class="paranum"><a name="p17.b">17.b/3</a></div>
<div class="Annotations"><B>Implementation defined:&nbsp;</B><span class="insert2">Any 
restrictions on a protected procedure or its containing type when&nbsp;</span><span class="insert3">an 
aspect</span><span class="insert2"></span><span class="insert2"><span class="delete3">&nbsp;a 
<SPAN Class="swiss"><A HREF="AA-2-8.html#S0019">pragma</A></SPAN></span></span><span class="insert2">&nbsp;Attach_handler or Interrupt_Handler&nbsp;</span><span class="insert3">is specified</span><span class="insert2"></span><span class="insert2"><span class="delete3">&nbsp;applies</span></span><span class="insert2">.</span></div>
<div class="paranum"><a name="p18">18</a></div>
<div class="Normal">An implementation may use a different mechanism for 
invoking a protected procedure in response to a hardware interrupt than 
is used for a call to that protected procedure from a task.&nbsp;</div>
<div class="paranum"><a name="p18.a">18.a</a></div>
<div class="Annotations"><B>Discussion:&nbsp;</B>This is despite the fact 
that the priority of an interrupt handler (see <A HREF="AA-D-1.html">D.1</A>) 
is modeled after a hardware task calling the handler.&nbsp;</div>
<div class="paranum"><a name="p19">19/3</a></div>
<div class="Normal">&nbsp;{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0229-1.TXT">AI05-0229-1</A></I>} 
<A NAME="I8545"></A>Notwithstanding what this subclause says elsewhere, 
the Attach_Handler and Interrupt_Handler <span class="insert3">aspects</span><span class="delete3">&nbsp;pragmas</span> 
are allowed to be used for other, implementation defined, forms of interrupt 
handlers.&nbsp;</div>
<div class="paranum"><a name="p19.a">19.a/3</a></div>
<div class="Annotations"><B>Ramification:&nbsp;</B>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0229-1.TXT">AI05-0229-1</A></I>} 
For example, if an implementation wishes to allow interrupt handlers 
to have parameters, it is allowed to do so via these <span class="insert3">aspects</span><span class="delete3">&nbsp;pragmas</span>; 
it need not invent implementation-defined <span class="insert3">aspects</span><span class="delete3">&nbsp;pragmas</span> 
for the purpose.&nbsp;</div>
<div class="paranum"><a name="p19.b">19.b/3</a></div>
<div class="Annotations"><B>Implementation defined:&nbsp;</B><span class="insert2">Any 
other forms of interrupt handler supported by the Attach_Handler and 
Interrupt_Handler&nbsp;</span><span class="insert3">aspects</span><span class="insert2"></span><span class="insert2"><span class="delete3">&nbsp;pragmas</span></span><span class="insert2">.</span></div>

<H4 Class="centered">Implementation Advice</H4>
<div class="paranum"><a name="p20">20</a></div>
<div class="Normal">Whenever possible, the implementation should allow 
interrupt handlers to be called directly by the hardware.&nbsp;</div>
<div class="paranum"><a name="p20.a">20.a/2</a></div>
<div class="Annotations"><span class="insert2"><B>Implementation Advice: 
</B></span><span class="insert2">Interrupt handlers should be called 
directly by the hardware.</span></div>
<div class="paranum"><a name="p21">21</a></div>
<div class="Normal">Whenever practical, the implementation should detect 
violations of any implementation-defined restrictions before run time. 
</div>
<div class="paranum"><a name="p21.a">21.a/2</a></div>
<div class="Annotations"><span class="insert2"><B>Implementation Advice: 
</B></span><span class="insert2">Violations of any implementation-defined 
restrictions on interrupt handlers should be detected before run time.</span></div>
<div class="NotesHeader">NOTES</div>
<div class="paranum"><a name="p22">22/3</a></div>
<div class="Notes">4&nbsp;&nbsp;{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0229-1.TXT">AI05-0229-1</A></I>} 
The Attach_Handler <span class="insert3">aspect may</span><span class="delete3">&nbsp;pragma 
can</span> provide static attachment of handlers to interrupts if the 
implementation supports preelaboration of protected objects. (See <A HREF="AA-C-4.html">C.4</A>.)</div>
<div class="paranum"><a name="p23">23/2</a></div>
<div class="Notes">5&nbsp;&nbsp;{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00434.TXT">AI95-00434-01</A></I>} 
<span class="insert2">A</span><span class="delete2">&nbsp;The ceiling priority 
of a</span> protected object that <span class="insert2">has a (protected) 
procedure</span><span class="delete2">&nbsp;one of its procedures is</span> 
attached to an interrupt should <span class="insert2">have a ceiling 
priority</span><span class="delete2">&nbsp;be</span> at least as high as the 
highest processor priority at which that interrupt will ever be delivered.</div>
<div class="paranum"><a name="p24">24</a></div>
<div class="Notes">6&nbsp;&nbsp;Protected procedures can also be attached 
dynamically to interrupts via operations declared in the predefined package 
Interrupts.</div>
<div class="paranum"><a name="p25">25</a></div>
<div class="Notes">7&nbsp;&nbsp;An example of a possible implementation-defined 
restriction is disallowing the use of the standard storage pools within 
the body of a protected procedure that is an interrupt handler.</div>

<H4 Class="centered">Incompatibilities With Ada 95</H4>
<div class="paranum"><a name="p25.a">25.a/2</a></div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00253.TXT">AI95-00253-01</A></I>} 
<span class="insert2"><A NAME="I8546"></A><B>Amendment Correction:</B> 
Corrected the wording so that the rules for the use of Attach_Handler 
and Interrupt_Handler are identical. This means that uses of pragma Interrupt_Handler 
outside of the target protected type or single protected object are now 
illegal.</span>&nbsp;</div>

<H4 Class="centered">Wording Changes from Ada 95</H4>
<div class="paranum"><a name="p25.b">25.b/2</a></div>
<div class="Annotations">{<I><A HREF="defect1.html#8652/0068">8652/0068</A></I>} 
<span class="insert2"></span>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00121.TXT">AI95-00121-01</A></I>} 
<span class="insert2"><B>Corrigendum:</B> Clarified the meaning of &ldquo;the 
previous handler&rdquo; when finalizing protected objects containing 
interrupt handlers.</span></div>
<div class="paranum"><a name="p25.c">25.c/2</a></div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00303.TXT">AI95-00303-01</A></I>} 
<span class="insert2">Dropped the requirement that an object of a type 
containing an Interrupt_Handler pragma must be declared at the library 
level. This was a generic contract model violation. This change is not 
an extension, as an attempt to attach such a handler with a routine in 
package Interrupts will fail an accessibility check anyway. Moreover, 
implementations can retain the rule as an implementation-defined restriction 
on the use of the type, as permitted by the Implementation Permissions 
above.</span>&nbsp;</div>

<H4 Class="centered">Extensions to Ada 2005</H4>
<div class="paranum"><a name="p25.d">25.d/3</a></div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0229-1.TXT">AI05-0229-1</A></I>} 
<span class="insert3"><A NAME="I8547"></A>Aspects Interrupt_Handler and 
Attach_Handler are new; <SPAN Class="swiss"><A HREF="AA-2-8.html#S0019">pragma</A></SPAN>s 
Interrupt_Handler and Attach_Handler are now obsolescent.</span>&nbsp;</div>

<H4 Class="centered">Wording Changes from Ada 2005</H4>
<div class="paranum"><a name="p25.e">25.e/3</a></div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0033-1.TXT">AI05-0033-1</A></I>} 
<span class="insert3"><A NAME="I8548"></A><B>Correction:</B> Added missing 
generic contract wording for the aspects Attach_Handler and Interrupt_Handler.</span> 
</div>

</div>
<div style="margin-top: 0.0em; margin-bottom: 0.6em"><A HREF="AA-TOC.html"><IMG SRC="cont.gif" ALT="Contents" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-0-4.html"><IMG SRC="index.gif" ALT="Index" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-STDS.html"><IMG SRC="lib.gif" ALT="References" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-SRCH.html"><IMG SRC="find.gif" ALT="Search" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-C-3.html"><IMG SRC="prev.gif" ALT="Previous" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-C-3-2.html"><IMG SRC="next.gif" ALT="Next" BORDER=0></A>&nbsp;
</div>
<DIV Style="margin-top:0.0em"><IMG SRC="AE_logo.gif" height=100 width=113 align=right ALT="Ada-Europe">
<SPAN Style="vertical-align: middle; font-size:120%">Ada 2005 and 2012 Editions sponsored in part by <SPAN Style="font-size: 125%"><A HREF="http://www.ada-europe.org/"><B>Ada-Europe</B></A></SPAN></SPAN></DIV>
</BODY>
</HTML>
